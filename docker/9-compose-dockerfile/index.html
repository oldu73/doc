
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.3">
    
    
      
        <title>Compose - 09 - Dockerfile - Doc</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.62128196.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>function __md_scope(e,t,_){return new URL(_||(t===localStorage?"../..":"../.."),location).pathname+"."+e}function __md_get(e,t=localStorage,_){return JSON.parse(t.getItem(__md_scope(e,t,_)))}function __md_set(e,t,_=localStorage,o){try{_.setItem(__md_scope(e,_,o),JSON.stringify(t))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#compose-09-dockerfile" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Doc" class="md-header__button md-logo" aria-label="Doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Doc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Compose - 09 - Dockerfile
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Doc" class="md-nav__button md-logo" aria-label="Doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Doc
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          MkDocs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MkDocs" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          MkDocs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mkdocs/mkdocs/" class="md-nav__link">
        MkDocs - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Git
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Git" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Git
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../git/git/" class="md-nav__link">
        Git - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          ElasticSearch
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ElasticSearch" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          ElasticSearch
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elasticsearch/elasticsearch/" class="md-nav__link">
        ElasticSearch - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          IntelliJ
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="IntelliJ" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          IntelliJ
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intellij/1-intellij-misc/" class="md-nav__link">
        IntelliJ - 01 - Misc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intellij/2-intellij-wsl/" class="md-nav__link">
        IntelliJ - 02 - WSL
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/1-linux-misc/" class="md-nav__link">
        Linux - 01 - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Docker" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1-docker-misc/" class="md-nav__link">
        Docker - 01 - Misc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2-docker-basis/" class="md-nav__link">
        Docker - 02 - Basis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../3-docker-dockerfile/" class="md-nav__link">
        Docker - 03 - Docker File
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../4-docker-dockerhub/" class="md-nav__link">
        Docker - 04 - Docker Hub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../5-docker-nodeserver/" class="md-nav__link">
        Docker - 05 - Node Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../6-docker-datapersistence/" class="md-nav__link">
        Docker - 06 - Data Persistence
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../7-docker-network/" class="md-nav__link">
        Docker - 07 - Network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../8-compose-use/" class="md-nav__link">
        Compose - 08 - Use
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Compose - 09 - Dockerfile
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Compose - 09 - Dockerfile
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-of-client-application-project" class="md-nav__link">
    Setup of client application project
  </a>
  
    <nav class="md-nav" aria-label="Setup of client application project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node" class="md-nav__link">
    Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#react" class="md-nav__link">
    React
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerized" class="md-nav__link">
    Dockerized
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#live-reload" class="md-nav__link">
    Live reload
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-docker-compose" class="md-nav__link">
    Set up Docker Compose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-during-developpement" class="md-nav__link">
    Test during developpement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-environnement" class="md-nav__link">
    Production environnement
  </a>
  
    <nav class="md-nav" aria-label="Production environnement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-stage-dockerfile" class="md-nav__link">
    Multi stage Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-compose" class="md-nav__link">
    Docker Compose
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../10-compose-services/" class="md-nav__link">
        Compose - 10 - Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../11-compose-production/" class="md-nav__link">
        Compose - 11 - Production
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          VS Code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="VS Code" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          VS Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../vscode/vscode/" class="md-nav__link">
        VS Code - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Windows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Windows" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Windows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../windows/windows/" class="md-nav__link">
        Windows - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          MongoDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MongoDB" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          MongoDB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mongodb/mongodb/" class="md-nav__link">
        MongoDB - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11">
          Redis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Redis" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Redis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/1-redis-misc/" class="md-nav__link">
        Redis - 01 - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      
      
      
        <label class="md-nav__link" for="__nav_12">
          Agile Methodology
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Agile Methodology" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Agile Methodology
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../agilemethodology/1-agilemethodology-misc/" class="md-nav__link">
        Agile Methodology - 01 - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13">
          Kafka
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kafka" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          Kafka
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/1-kafka-misc/" class="md-nav__link">
        Kafka - 01 - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-of-client-application-project" class="md-nav__link">
    Setup of client application project
  </a>
  
    <nav class="md-nav" aria-label="Setup of client application project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node" class="md-nav__link">
    Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#react" class="md-nav__link">
    React
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerized" class="md-nav__link">
    Dockerized
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#live-reload" class="md-nav__link">
    Live reload
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-docker-compose" class="md-nav__link">
    Set up Docker Compose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-during-developpement" class="md-nav__link">
    Test during developpement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-environnement" class="md-nav__link">
    Production environnement
  </a>
  
    <nav class="md-nav" aria-label="Production environnement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-stage-dockerfile" class="md-nav__link">
    Multi stage Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker-compose" class="md-nav__link">
    Docker Compose
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="compose-09-dockerfile">Compose - 09 - Dockerfile</h1>
<p>Docker Compose - Dockerfile</p>
<p>!WSL2, advised to not use a mounted volume like '/mnt/c/' for handling a project to avoid slowness and live reload issues.
Instead, prefer usage of a "native" WSL2 folder like for e.g. '/home/user/react-nginx'</p>
<p>Dockerfile and Docker Compose to set up a client application composed of:  </p>
<ul>
<li>React  </li>
<li>NGINX  </li>
</ul>
<hr />
<h2 id="setup-of-client-application-project">Setup of client application project</h2>
<h3 id="node">Node</h3>
<p>'create-React-app' is a script to install with 'npm' will pre-configure a 'webpack' environnement and give use access to a development server and a test server and a build command for production.</p>
<p>Role of 'NGINX' (http server) is to treat all http(s) request and return response from 'React' application to requester.</p>
<p>In this chapter we will see two new features:  </p>
<ul>
<li>Dockerfile multi staging, defined with many 'from'.  </li>
<li>Stdin_open and TTY, two new options of Docker Compose.  </li>
</ul>
<p>Prerequisite, install on host machine:  </p>
<ul>
<li>'nvm' - <a href="https://github.com/nvm-sh/nvm">Node Version Manager</a>  </li>
<li>'Node.js'</li>
</ul>
<p>Set/check installation with:</p>
<pre><code class="language-console">// Setup project root folder
mkdir react-nginx
cd react-nginx

// To install 'nvm'
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash

// Check
nvm

// Get last version
nvm ls-remote | tail
.
.
v17.0.1
        v17.1.0
        v17.2.0
        v17.3.0

// Install last version
nvm install 17.3.0

node -v
v17.3.0

node
Welcome to Node.js v17.3.0.       
Type &quot;.help&quot; for more information.
&gt;
(To exit, press Ctrl+C again or Ctrl+D or type .exit)
&gt;
</code></pre>
<h3 id="react">React</h3>
<p>Instal 'React' with 'npx' (like npm but executed once with last script release):</p>
<pre><code class="language-console">npx create-react-app client
cd client
ls
README.md  node_modules  package-lock.json  package.json  public  src
npm start
.
.
Compiled successfully!

You can now view client in the browser.

  Local:            http://localhost:3000
</code></pre>
<p>Browse to: - <a href="http://localhost:3000">http://localhost:3000</a></p>
<p>Test (launch tests contained in react-nginx/client/src/App.test.js):</p>
<pre><code class="language-console">npm run test
</code></pre>
<p>!! Fail on WSL2 :(</p>
<p>Build for production (add a build folder to the project, this is the folder to return via NGINX for client):</p>
<pre><code class="language-console">npm run build
</code></pre>
<p>All of this just to initialize the project locally on host machine.</p>
<h3 id="dockerized">Dockerized</h3>
<p>We may now <strong>delete the 'node_modules' folder</strong> ('node_modules' folder will then be only in container initialized with dependencies through 'npm install' command in 'Dockerfile'):</p>
<pre><code class="language-console">rm -rf node_modules/
</code></pre>
<p>Add a 'Dockerfile' in client project folder '/home/user/react-nginx/client':</p>
<pre><code class="language-console">touch Dockerfile
</code></pre>
<p>Dockerfile:</p>
<pre><code class="language-text">FROM node:alpine
WORKDIR /app
COPY package.json .
RUN npm install
COPY . .
CMD [&quot;npm&quot;, &quot;start&quot;]
</code></pre>
<p>Build docker image:</p>
<pre><code class="language-console">docker build -t myreact .

docker image ls
REPOSITORY                        TAG       IMAGE ID       CREATED          SIZE  
myreact                           latest    c4c1b5bb9d21   45 seconds ago   483MB

docker run --rm --name react -p 3000:3000 myreact
</code></pre>
<p>Browse to: - <a href="http://localhost:3000">http://localhost:3000</a></p>
<hr />
<h2 id="live-reload">Live reload</h2>
<p>It's important to launch <strong>from a terminal</strong> a based VS Code instance from root client application folder to get live reload effect that works:</p>
<pre><code class="language-console">cd .../react-nginx/client
code .
</code></pre>
<p>For development purpose, to automatically propagate local changes to container.</p>
<p>Bind mount project folder:</p>
<pre><code class="language-console">docker run --rm --name react -p 3000:3000 --mount type=bind,src=&quot;$(pwd)&quot;,target=/app myreact
</code></pre>
<p>!! =&gt; FAIL!! Why? Because when bind mount it crush all what was contained in container '/app' folder with local content and in local there isn't anymore 'node_modules' folder.</p>
<p>To avoid this unwanted behavior and keep 'node_modules' in container folder not erased by bind mount (also needed for live reload feature), we bind an anonymous volume targeted on remote container '/app/node_modules' folder.</p>
<p>Also, to avoid 'EACCES: permission denied' issue on '/app/node_modules/.cache' folder we modify 'Dockerfile' as follow:</p>
<pre><code class="language-text">FROM node:alpine
WORKDIR /app
COPY package.json .
RUN npm install
# To avoid 'EACCES: permission denied' issue on '/app/node_modules/.cache' folder
RUN mkdir -p node_modules/.cache &amp;&amp; chmod -R 777 node_modules/.cache
COPY . .
CMD [&quot;npm&quot;, &quot;start&quot;]
</code></pre>
<p>Bind mount project folder + anonymous volume with '/app/node_modules' as target:</p>
<pre><code class="language-console">docker run --rm --name react -p 3000:3000 --mount type=bind,src=&quot;$(pwd)&quot;,target=/app --mount type=volume,target=/app/node_modules myreact
</code></pre>
<p>It's advised to run with '--rm' option when using anonymous volume to suppress it automatically on stop in addition to container suppression.</p>
<p>Test live reload by changing text '.. save to reload.' with e.g. 'Hello, world!" in 'src/App.js' and then observe live effect at <a href="http://localhost:3000">http://localhost:3000</a> in an Internet browser.</p>
<hr />
<h2 id="set-up-docker-compose">Set up Docker Compose</h2>
<p>docker-compose.yml</p>
<pre><code class="language-yaml">version: &quot;3.8&quot;
services:
  client:
    build: .
    ports:
      - 3000:3000
    volumes:
      - type: bind
        source: .
        target: /app
      - type: volume
        target: /app/node_modules
</code></pre>
<p>Reset Docker:</p>
<pre><code class="language-console">docker system prune -a
docker volume prune
</code></pre>
<p>Start service:</p>
<pre><code class="language-console">docker-compose up
</code></pre>
<p>You may observe live reload working by changing 'App.js' content and 'localhost:3000' changing accordingly.</p>
<hr />
<h2 id="test-during-developpement">Test during developpement</h2>
<p>Note:</p>
<ul>
<li><a href="https://webpack.js.org/">webpack</a> is an open-source JavaScript module bundler (wikipedia).  </li>
<li>TDD (Test Driven Development).</li>
</ul>
<p>In a devellopement process it's mostly advised to continuously test in order to check that we don't brake anything.<br />
To achieve this, we lauch two terminals in prallel, one with webpack for running application and this other one for automatic testing purpose.<br />
It's done with same container image and duplicate services in Docker Compose configuration file, only thing that will change for second duplicated service is that we override command from Dockerfile in Docker Compose configuration file to launch test server and remove also port mapping which is useless for tests.</p>
<p>docker-compose.yml:</p>
<pre><code class="language-yaml">version: &quot;3.8&quot;
services:
  client:
    build: .
    ports:
      - 3000:3000
    volumes:
      - type: bind
        source: .
        target: /app
      - type: volume
        target: /app/node_modules
  test:
    build: .
    command: [&quot;npm&quot;, &quot;run&quot;, &quot;test&quot;]
    volumes:
      - type: bind
        source: .
        target: /app
      - type: volume
        target: /app/node_modules
</code></pre>
<pre><code class="language-console">docker-compose up --build
</code></pre>
<p>In logs we may observe:</p>
<pre><code class="language-console">.
.
test_1    | Tests:       1 passed, 1 total
.
.
</code></pre>
<p>If we duplicate one exsisting test in '.../src/App.test.js' file, we may observe live change in logs:</p>
<pre><code class="language-console">.
.
test_1    | Tests:       2 passed, 2 total
.
.
</code></pre>
<p>To interact with test server we need a second terminal.<br />
If we want to send command in test container when attaching to it we need to add two options to the test service in Docker Compose configuration file, 'stdin_open' and 'tty', both set to 'true'.</p>
<p>docker-compose.yml:</p>
<pre><code class="language-yaml">version: &quot;3.8&quot;
services:
  client:
    build: .
    ports:
      - 3000:3000
    volumes:
      - type: bind
        source: .
        target: /app
      - type: volume
        target: /app/node_modules
  test:
    build: .
    command: [&quot;npm&quot;, &quot;run&quot;, &quot;test&quot;]
    volumes:
      - type: bind
        source: .
        target: /app
      - type: volume
        target: /app/node_modules
    stdin_open: true
    tty: true
</code></pre>
<p>In first terminal:</p>
<pre><code class="language-console">docker-compose down -v
docker-compose up --build
</code></pre>
<p>In second terminal:</p>
<pre><code class="language-console">docker container ls

CONTAINER ID   IMAGE           COMMAND                  CREATED              STATUS              PORTS                    NAMES
ca16b44236ad   client_test     &quot;docker-entrypoint.s…&quot;   About a minute ago   Up About a minute                            client_test_1
4633b0999f9c   client_client   &quot;docker-entrypoint.s…&quot;   About a minute ago   Up About a minute   0.0.0.0:3000-&gt;3000/tcp   client_client_1

docker attach client_test_1
.
.
Watch Usage
 › Press f to run only failed tests.
 › Press o to only run tests related to changed files.
 › Press q to quit watch mode.
 › Press p to filter by a filename regex pattern.
 › Press t to filter by a test name regex pattern.
 › Press Enter to trigger a test run.
</code></pre>
<p>We may now send commands to test server in second terminal.</p>
<p>Then, shutdown gracefully:</p>
<pre><code class="language-console">docker-compose down -v
</code></pre>
<hr />
<h2 id="production-environnement">Production environnement</h2>
<h3 id="introduction">Introduction</h3>
<p>NGINX return the build.</p>
<p>NGINX intercept http request and return by default an html file.</p>
<p>Browse <a href="https://hub.docker.com/_/nginx#:~:text=Hosting%20some%20simple%20static%20content">docker hub for nginx on official image page to host some simple static content</a>.</p>
<p>Simple test:</p>
<pre><code class="language-console">docker run --rm -p 80:80 nginx
</code></pre>
<p>Browse to <a href="http://localhost/">localhost</a></p>
<p>In a second terminal:</p>
<pre><code class="language-console">docker exec -it exciting_elion sh

cd usr/share/nginx/html

ls
50x.html  index.html

cat index.html
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
.
.
</code></pre>
<p>It's in this folder we gonna copy our application '/usr/share/nginx/html'.</p>
<p>For more complex configuration, have a look in '/etc/nginx/conf.d' folder.</p>
<h3 id="multi-stage-dockerfile">Multi stage Dockerfile</h3>
<p>Reuse a preceding builded image in next build.</p>
<p>Goal to reach here is to put React's build folder into NGINX image.</p>
<p>../client/Dockerfile.prod</p>
<pre><code class="language-text">FROM node:alpine as buildstage
WORKDIR /app
COPY package.json .
RUN npm install
COPY . .
RUN npm run build

FROM nginx
COPY --from=buildstage /app/build /usr/share/nginx/html
EXPOSE 80
</code></pre>
<p>After second FROM above, --from=buildstage refer to first stage of image build (npm run build, output is a 'build' folder that containe production application).</p>
<p>Build Docker image:</p>
<pre><code class="language-console">docker build -t nginxreact -f Dockerfile.prod .
.
.
 =&gt; [stage-1 2/2] COPY --from=buildstage /app/build /usr/share/nginx/html
.
.

docker image ls
REPOSITORY      TAG       IMAGE ID       CREATED         SIZE
nginxreact      latest    ee3388384541   4 minutes ago   141MB
.
.
&lt;none&gt;          &lt;none&gt;    1c9dc1e2c948   6 hours ago     483MB
.
.
</code></pre>
<p>"\&lt;none>" image are produced by intermediate build stage(s).</p>
<p>Launch a container with just built image:</p>
<pre><code class="language-console">docker run --rm -p 80:80 nginxreact
</code></pre>
<p>Browse to <a href="http://localhost/">localhost</a> to observe your production application running.</p>
<h3 id="docker-compose">Docker Compose</h3>
<p>A new Docker Compose configuration file dedicated to prodction:</p>
<pre><code class="language-console">touch docker-compose.prod.yml
</code></pre>
<p>docker-compose.prod.yml</p>
<pre><code class="language-yaml">version: &quot;3.8&quot;
services:
  mynginx:
    build:
      context: .
      dockerfile: Dockerfile.prod
    ports:
      - 80:80
</code></pre>
<p>Reset Docker content:</p>
<pre><code class="language-console">docker system prune -a
docker volume prune
</code></pre>
<p>Start a fresh new production application:</p>
<pre><code class="language-console">docker-compose -f docker-compose.prod.yml up
</code></pre>
<p>Browse to <a href="http://localhost/">localhost</a> to observe your production application running.</p>
<hr />

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../8-compose-use/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Compose - 08 - Use" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Compose - 08 - Use
            </div>
          </div>
        </a>
      
      
        
        <a href="../10-compose-services/" class="md-footer__link md-footer__link--next" aria-label="Next: Compose - 10 - Services" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Compose - 10 - Services
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.01824240.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.e0abf5b0.min.js"></script>
      
    
  </body>
</html>