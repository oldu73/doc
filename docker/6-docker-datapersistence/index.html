
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.3">
    
    
      
        <title>Docker - 6 - Data Persistence - Doc</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.62128196.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>function __md_scope(e,t,_){return new URL(_||(t===localStorage?"../..":"../.."),location).pathname+"."+e}function __md_get(e,t=localStorage,_){return JSON.parse(t.getItem(__md_scope(e,t,_)))}function __md_set(e,t,_=localStorage,o){try{_.setItem(__md_scope(e,_,o),JSON.stringify(t))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#docker-6-data-persistence" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Doc" class="md-header__button md-logo" aria-label="Doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Doc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docker - 6 - Data Persistence
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Doc" class="md-nav__button md-logo" aria-label="Doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Doc
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          MkDocs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MkDocs" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          MkDocs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mkdocs/mkdocs/" class="md-nav__link">
        MkDocs - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Git
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Git" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Git
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../git/git/" class="md-nav__link">
        Git - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          ElasticSearch
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ElasticSearch" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          ElasticSearch
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elasticsearch/elasticsearch/" class="md-nav__link">
        ElasticSearch - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Intellij
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Intellij" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Intellij
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intellij/intellij/" class="md-nav__link">
        Intellij - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/linux/" class="md-nav__link">
        Linux - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Docker" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1-docker-misc/" class="md-nav__link">
        Docker - 1 - Misc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2-docker-basis/" class="md-nav__link">
        Docker - 2 - Basis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../3-docker-dockerfile/" class="md-nav__link">
        Docker - 3 - Docker File
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../4-docker-dockerhub/" class="md-nav__link">
        Docker - 4 - Docker Hub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../5-docker-nodeserverimage/" class="md-nav__link">
        Docker - 5 - Node Server Image
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Docker - 6 - Data Persistence
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Docker - 6 - Data Persistence
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    Volumes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bind-mount" class="md-nav__link">
    Bind mount
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmpfs" class="md-nav__link">
    TMPFS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bind-mount_1" class="md-nav__link">
    Bind mount
  </a>
  
    <nav class="md-nav" aria-label="Bind mount">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#development-environment" class="md-nav__link">
    Development environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes_1" class="md-nav__link">
    Volumes
  </a>
  
    <nav class="md-nav" aria-label="Volumes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    Create
  </a>
  
    <nav class="md-nav" aria-label="Create">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-volume" class="md-nav__link">
    New volume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#new-container-with-bind-volume" class="md-nav__link">
    New container with bind volume
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#share-backup-restore" class="md-nav__link">
    Share Backup Restore
  </a>
  
    <nav class="md-nav" aria-label="Share Backup Restore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#share-volume-between-containers" class="md-nav__link">
    Share volume between containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backup-volume" class="md-nav__link">
    Backup volume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore-volume" class="md-nav__link">
    Restore volume
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-to-persist-a-database-mongo" class="md-nav__link">
    Volume to persist a database (mongo)
  </a>
  
    <nav class="md-nav" aria-label="Volume to persist a database (mongo)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compass-gui-to-browse-mongo-db" class="md-nav__link">
    Compass GUI to browse mongo db
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          VS Code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="VS Code" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          VS Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../vscode/vscode/" class="md-nav__link">
        VS Code - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Windows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Windows" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Windows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../windows/windows/" class="md-nav__link">
        Windows - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    Volumes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bind-mount" class="md-nav__link">
    Bind mount
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmpfs" class="md-nav__link">
    TMPFS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bind-mount_1" class="md-nav__link">
    Bind mount
  </a>
  
    <nav class="md-nav" aria-label="Bind mount">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#development-environment" class="md-nav__link">
    Development environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes_1" class="md-nav__link">
    Volumes
  </a>
  
    <nav class="md-nav" aria-label="Volumes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    Create
  </a>
  
    <nav class="md-nav" aria-label="Create">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#new-volume" class="md-nav__link">
    New volume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#new-container-with-bind-volume" class="md-nav__link">
    New container with bind volume
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#share-backup-restore" class="md-nav__link">
    Share Backup Restore
  </a>
  
    <nav class="md-nav" aria-label="Share Backup Restore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#share-volume-between-containers" class="md-nav__link">
    Share volume between containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backup-volume" class="md-nav__link">
    Backup volume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore-volume" class="md-nav__link">
    Restore volume
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volume-to-persist-a-database-mongo" class="md-nav__link">
    Volume to persist a database (mongo)
  </a>
  
    <nav class="md-nav" aria-label="Volume to persist a database (mongo)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compass-gui-to-browse-mongo-db" class="md-nav__link">
    Compass GUI to browse mongo db
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="docker-6-data-persistence">Docker - 6 - Data Persistence</h1>
<hr />
<h2 id="introduction">Introduction</h2>
<p>Container =
- writable layer (this layer is deleted if the container no longer exists)
- image layer(s) (read)</p>
<p>Writable layers use UnionFS, slow read write performance, not adapted to host database.</p>
<p>To persist data, 3 possibilities:</p>
<h3 id="volumes">Volumes</h3>
<p>On Filesystem but managed by Docker, accessible through Docker CLI), mostly advised to use (in /var/lib/docker/volumes/ (not on WSL) but never access it directly.
Volumes are stored on but isolated from host machine.</p>
<p>Create a volume with Docker CLI command</p>
<pre><code>docker volume create
</code></pre>
<h3 id="bind-mount">Bind mount</h3>
<p>Manged by Filesystem and accessible from outside of Docker, not recommended.
Bind mounts are regular folder and files stored on host machine.</p>
<h3 id="tmpfs">TMPFS</h3>
<p>Temporary File System -&gt; RAM.
TMPFS are used to store temporary not persisted data, sensitive information like secret.</p>
<hr />
<h2 id="bind-mount_1">Bind mount</h2>
<p>Adapted for:
- Sharing configuration files between host and container.
- Development environment to share source code and alow live reload.</p>
<p>Recommend syntax</p>
<pre><code>docker run --mount type=bind,source=&lt;url&gt;,target=&lt;url&gt; image
</code></pre>
<pre><code>$ mkdir data
$ cd data
$ touch hello.txt
$ cd ..
$ docker run --mount type=bind,source=&quot;$(pwd)&quot;/data,target=/data -it alpine sh
$c ls
.. data ..
$c cd data
$c ls
hello.txt
</code></pre>
<p>Search for Mounts section with inspect CLI command to see mounting details:</p>
<pre><code>docker container inspect containerName
</code></pre>
<h3 id="development-environment">Development environment</h3>
<p>Set up of a development environnement for a node server application (c.f. <a href="../5-docker-nodeserverimage/#node-server-project">Node server project</a>).  </p>
<p>The goal here is to have changes available from host machine (IDE) in container and automatically reloaded by nodemon.</p>
<p>!!Warning!! A common mistake is to bind the root folder of a project.</p>
<p>E.g. in case of node context, if we do so, the node_modules folder created/populated in container image by "RUN npm install" instruction from Dockerfile will be erased. To avoid this unwanted behavior, it's mostly advised to move the source code files modified through IDE on host machine in a dedicated folder (e.g. src).</p>
<p>On host machine:</p>
<pre><code>$ mkdir node-server
$ cd node-server
$ mkdir src
$ cd src
$ touch app.js
$ cd ..
</code></pre>
<p>src/app.js:</p>
<pre><code>const express = require('express');

const app = express();

app.get('*', (req, res) =&gt; {
    res.status(200).json('Hello, world!');
})

app.listen(80);
</code></pre>
<p>Dockerfile (in root folder, "node-server"):</p>
<pre><code>FROM node:alpine
WORKDIR /app
COPY ./package.json .
RUN npm install
COPY . .
ENV PATH=$PATH:/app/node_modules/.bin
CMD [&quot;nodemon&quot;, &quot;-L&quot;, &quot;src/app.js&quot;]
</code></pre>
<p>!! Warning !! In above Dockerfile we use <strong>-L</strong> option for --legacy-watch because in some containerized environnement, application may not restart automatically after file's change.</p>
<p>Build image:</p>
<pre><code>$ docker build -t myapp .
</code></pre>
<p>Start a container with new image version:</p>
<pre><code>$ docker run --rm -p 80:80 --mount type=bind,source=&quot;$(pwd)/src&quot;,target=/app/src myapp
</code></pre>
<p>Now try to edit 'src/app.js' file on host machine to observe nodemon restart in terminal.<br />
You may also observe the changes on your browser at 'localhost' address, after refresh.</p>
<hr />
<h2 id="volumes_1">Volumes</h2>
<p>docker volume
- create
- inspect
- ls
- rm
- prune</p>
<p>old syntax (not advised, c.f. bind)</p>
<pre><code>docker run -v &lt;volume-name&gt;:&lt;container-url&gt; image
</code></pre>
<p>new syntax</p>
<pre><code>docker run --mount type=volume,source=&lt;volume-name&gt;,target=&lt;url&gt; image
</code></pre>
<h3 id="create">Create</h3>
<h4 id="new-volume">New volume</h4>
<pre><code>$ docker volume create mydata
mydata

$ docker volume ls
DRIVER    VOLUME NAME
local     mydata

$ docker volume inspect mydata
[
    {
        &quot;CreatedAt&quot;: &quot;2021-12-24T06:15:34Z&quot;,
        &quot;Driver&quot;: &quot;local&quot;,
        &quot;Labels&quot;: {},
        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/mydata/_data&quot;,
        &quot;Name&quot;: &quot;mydata&quot;,
        &quot;Options&quot;: {},
        &quot;Scope&quot;: &quot;local&quot;
    }
]
</code></pre>
<p>WSL2 volumes are not in /var/lib/docker/volumes/mydata/_data</p>
<p>You can find WSL2 volumes under a hidden network share. Open Windows Explorer, and type <strong>\\wsl$</strong> into the location bar. Hit enter, and it should display your WSL volumes, including the ones for Docker for Windows.</p>
<p>WSL2 volumes, in Windows Explorer bar</p>
<pre><code>\\wsl$\docker-desktop-data\version-pack-data\community\docker\volumes
</code></pre>
<h4 id="new-container-with-bind-volume">New container with bind volume</h4>
<pre><code class="language-console">$ docker run --mount type=volume,source=mydata,target=/data -it alpine sh
$c cd data
$c touch hello.txt
$c echo 123 &gt; hello.txt
ctrl+d
$ docker rm containername
$ docker run --mount type=volume,source=mydata,target=/data -it alpine sh
$c cd data
$c cat hello.txt
123
</code></pre>
<h3 id="share-backup-restore">Share Backup Restore</h3>
<h4 id="share-volume-between-containers">Share volume between containers</h4>
<pre><code class="language-console">$ docker run --mount type=volume,source=mydata,target=/data --name firstcont -it alpine sh
$c1 cd data
In another terminal
$ docker run --mount type=volume,source=mydata,target=/data --name secondcont -it alpine sh
$c2 cd data
$c2 touch new.txt
$c1 ls
hello.txt  new.txt
</code></pre>
<p>Another way is volume from container</p>
<pre><code class="language-console">$ docker run --volumes-from firstcont --name thirdcont -it alpine sh
</code></pre>
<h4 id="backup-volume">Backup volume</h4>
<p>Compress a volume to a bind folder with tar</p>
<pre><code class="language-console">$ mkdir backup
$ docker run --mount type=volume,source=mydata,target=/data --mount type=bind,source=&quot;$(pwd)&quot;/backup,target=/backup alpine tar -czf /backup/mydata.tar.gz /data
</code></pre>
<h4 id="restore-volume">Restore volume</h4>
<p>Extract an archive from a bind folder to a volume</p>
<pre><code class="language-console">$ docker volume create restore

$ docker run --mount type=volume,source=restore,target=/data --mount type=bind,source=&quot;$(pwd)&quot;/backup,target=/backup alpine tar -xf /backup/mydata.tar.gz -C /data
</code></pre>
<p>To not have a folder data in a folder data, use tar with option --strip-components 1</p>
<pre><code class="language-console">$ docker run --mount type=volume,source=restore,target=/data --mount type=bind,source=&quot;$(pwd)&quot;,target=/backup -it alpine tar -xf /backup/backup.tar --strip-components 1 -C /data
</code></pre>
<p>Check volume correctly restored</p>
<pre><code class="language-console">$ docker container run -it --rm --mount source=restore,target=/data alpine sh
</code></pre>
<h3 id="volume-to-persist-a-database-mongo">Volume to persist a database (mongo)</h3>
<p>For mongo db it consist of mounting a volume with folder /data/db in mongo container</p>
<pre><code class="language-console">$ docker volume create mydb
$ docker run --mount type=volume,source=mydb,target=/data/db -d --name mongocontainer1 mongo
$ docker exec -it mongocontainer1 sh
$c mongo
&gt; use test
switched to db test
&gt; db.user.insertOne({ name: 'jean' })
{
        &quot;acknowledged&quot; : true,
        &quot;insertedId&quot; : ObjectId(&quot;61caeae2df845609f1835264&quot;)
}
&gt; db.user.findOne()
{ &quot;_id&quot; : ObjectId(&quot;61caeae2df845609f1835264&quot;), &quot;name&quot; : &quot;jean&quot; }
&gt; exit
bye
$c exit
$ docker container stop mongocontainer1
$ docker container rm mongocontainer1
</code></pre>
<p>Container is removed but database is persisted in a volume.</p>
<pre><code class="language-console">$ docker run --mount type=volume,source=mydb,target=/data/db -d --name mongocontainer2 mongo
$ docker exec -it mongocontainer1 sh
$c mongo
&gt; use test
switched to db test
&gt; db.user.findOne()
{ &quot;_id&quot; : ObjectId(&quot;61caeae2df845609f1835264&quot;), &quot;name&quot; : &quot;jean&quot; }
</code></pre>
<h4 id="compass-gui-to-browse-mongo-db">Compass GUI to browse mongo db</h4>
<p>Should run container with opened port (default 27017).<br />
If port is already used on host machine, you may use 27018 for example</p>
<pre><code class="language-console">$ docker run -p 27018:27017 --mount type=volume,source=mydb,target=/data/db -d --name mongocontainer3 mongo
</code></pre>
<p>Enter in connection field:<br />
mongodb://localhost:27018</p>
<hr />

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../5-docker-nodeserverimage/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Docker - 5 - Node Server Image" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Docker - 5 - Node Server Image
            </div>
          </div>
        </a>
      
      
        
        <a href="../../vscode/vscode/" class="md-footer__link md-footer__link--next" aria-label="Next: VS Code - Misc" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              VS Code - Misc
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.01824240.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.e0abf5b0.min.js"></script>
      
    
  </body>
</html>