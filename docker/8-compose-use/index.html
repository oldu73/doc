
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.3">
    
    
      
        <title>Compose - 08 - Use - Doc</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.62128196.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>function __md_scope(e,t,_){return new URL(_||(t===localStorage?"../..":"../.."),location).pathname+"."+e}function __md_get(e,t=localStorage,_){return JSON.parse(t.getItem(__md_scope(e,t,_)))}function __md_set(e,t,_=localStorage,o){try{_.setItem(__md_scope(e,_,o),JSON.stringify(t))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#compose-08-use" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Doc" class="md-header__button md-logo" aria-label="Doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Doc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Compose - 08 - Use
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Doc" class="md-nav__button md-logo" aria-label="Doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Doc
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Agile Methodology
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Agile Methodology" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Agile Methodology
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../agilemethodology/1-agilemethodology-misc/" class="md-nav__link">
        Agile Methodology - 01 - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Docker" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1-docker-misc/" class="md-nav__link">
        Docker - 01 - Misc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2-docker-basis/" class="md-nav__link">
        Docker - 02 - Basis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../3-docker-dockerfile/" class="md-nav__link">
        Docker - 03 - Docker File
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../4-docker-dockerhub/" class="md-nav__link">
        Docker - 04 - Docker Hub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../5-docker-nodeserver/" class="md-nav__link">
        Docker - 05 - Node Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../6-docker-datapersistence/" class="md-nav__link">
        Docker - 06 - Data Persistence
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../7-docker-network/" class="md-nav__link">
        Docker - 07 - Network
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Compose - 08 - Use
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Compose - 08 - Use
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-use" class="md-nav__link">
    First use
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-image" class="md-nav__link">
    Custom image
  </a>
  
    <nav class="md-nav" aria-label="Custom image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#context-and-dockerfile" class="md-nav__link">
    Context and Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arguments" class="md-nav__link">
    Arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labels" class="md-nav__link">
    Labels
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ports" class="md-nav__link">
    Ports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    Volumes
  </a>
  
    <nav class="md-nav" aria-label="Volumes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bind" class="md-nav__link">
    Bind
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volumes_1" class="md-nav__link">
    Volumes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment Variables
  </a>
  
    <nav class="md-nav" aria-label="Environment Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-cli" class="md-nav__link">
    from cli
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-compose-file" class="md-nav__link">
    from compose file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-env-file" class="md-nav__link">
    from .env file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network" class="md-nav__link">
    Network
  </a>
  
    <nav class="md-nav" aria-label="Network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default" class="md-nav__link">
    Default
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#links" class="md-nav__link">
    Links
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#name" class="md-nav__link">
    Name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networks" class="md-nav__link">
    Networks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-application" class="md-nav__link">
    Sample application
  </a>
  
    <nav class="md-nav" aria-label="Sample application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mongodb" class="md-nav__link">
    MongoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nodejs" class="md-nav__link">
    Node.js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#depends-and-restart" class="md-nav__link">
    Depends and Restart
  </a>
  
    <nav class="md-nav" aria-label="Depends and Restart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#depends" class="md-nav__link">
    Depends
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restart" class="md-nav__link">
    Restart
  </a>
  
    <nav class="md-nav" aria-label="Restart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no" class="md-nav__link">
    no
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#always" class="md-nav__link">
    always
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#on-failure" class="md-nav__link">
    on-failure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unless-stopped" class="md-nav__link">
    unless-stopped
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-commands" class="md-nav__link">
    Other commands
  </a>
  
    <nav class="md-nav" aria-label="Other commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logs" class="md-nav__link">
    logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#top" class="md-nav__link">
    top
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    misc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-push" class="md-nav__link">
    pull push
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../9-compose-dockerfile/" class="md-nav__link">
        Compose - 09 - Dockerfile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../10-compose-services/" class="md-nav__link">
        Compose - 10 - Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../11-compose-production/" class="md-nav__link">
        Compose - 11 - Production
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          ElasticSearch
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ElasticSearch" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          ElasticSearch
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../elasticsearch/elasticsearch/" class="md-nav__link">
        ElasticSearch - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Git
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Git" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Git
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../git/git/" class="md-nav__link">
        Git - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          IntelliJ
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="IntelliJ" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          IntelliJ
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intellij/1-intellij-misc/" class="md-nav__link">
        IntelliJ - 01 - Misc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intellij/2-intellij-wsl/" class="md-nav__link">
        IntelliJ - 02 - WSL
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Java
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Java" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Java
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" type="checkbox" id="__nav_7_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1">
          test
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="test" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          test
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../java/test/mock/" class="md-nav__link">
        mock
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          JavaScript
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="JavaScript" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          JavaScript
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/misc/" class="md-nav__link">
        misc
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_2" type="checkbox" id="__nav_8_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_2">
          training
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="training" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_2">
          <span class="md-nav__icon md-icon"></span>
          training
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_2_1" type="checkbox" id="__nav_8_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_2_1">
          02-environment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="02-environment" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_2_1">
          <span class="md-nav__icon md-icon"></span>
          02-environment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/02-environment/06-install-environnement/" class="md-nav__link">
        06-install-environnement
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/02-environment/08-install-babel/" class="md-nav__link">
        08-install-babel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/02-environment/09-javascript-in-html/" class="md-nav__link">
        09-javascript-in-html
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/02-environment/10-webpack/" class="md-nav__link">
        10-webpack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/02-environment/11-console/" class="md-nav__link">
        11-console
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_2_2" type="checkbox" id="__nav_8_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_2_2">
          03-basis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="03-basis" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_2_2">
          <span class="md-nav__icon md-icon"></span>
          03-basis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/03-basis/12-intro-and-var/" class="md-nav__link">
        12-intro-and-var
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/03-basis/13-let-and-const/" class="md-nav__link">
        13-let-and-const
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/03-basis/14-hoisting/" class="md-nav__link">
        14-hoisting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/03-basis/15-type/" class="md-nav__link">
        15-type
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/03-basis/16-operator-1/" class="md-nav__link">
        16-operator-1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/03-basis/17-coercion/" class="md-nav__link">
        17-coercion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/03-basis/18-operator-2/" class="md-nav__link">
        18-operator-2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/03-basis/19-value-and-reference/" class="md-nav__link">
        19-value-and-reference
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_2_3" type="checkbox" id="__nav_8_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_2_3">
          04-control
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="04-control" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_2_3">
          <span class="md-nav__icon md-icon"></span>
          04-control
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/04-control/20-condition/" class="md-nav__link">
        20-condition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/04-control/21-ternary-operator/" class="md-nav__link">
        21-ternary-operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/04-control/22-switch/" class="md-nav__link">
        22-switch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/04-control/23-for/" class="md-nav__link">
        23-for
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/04-control/24-while/" class="md-nav__link">
        24-while
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_2_4" type="checkbox" id="__nav_8_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_2_4">
          05-number
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="05-number" data-md-level="3">
        <label class="md-nav__title" for="__nav_8_2_4">
          <span class="md-nav__icon md-icon"></span>
          05-number
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../javascript/training/05-number/25-introduction/" class="md-nav__link">
        25-introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          JMeter
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="JMeter" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          JMeter
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jmeter/1-jmeter-misc/" class="md-nav__link">
        JMeter - 01 - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Kafka
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kafka" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Kafka
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kafka/1-kafka-misc/" class="md-nav__link">
        Kafka - 01 - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/1-linux-misc/" class="md-nav__link">
        Linux - 01 - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      
      
      
        <label class="md-nav__link" for="__nav_12">
          MkDocs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MkDocs" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          MkDocs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mkdocs/mkdocs/" class="md-nav__link">
        MkDocs - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13">
          MongoDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MongoDB" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          MongoDB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mongodb/mongodb/" class="md-nav__link">
        MongoDB - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_14" type="checkbox" id="__nav_14" >
      
      
      
      
        <label class="md-nav__link" for="__nav_14">
          Redis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Redis" data-md-level="1">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          Redis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/1-redis-misc/" class="md-nav__link">
        Redis - 01 - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_15" type="checkbox" id="__nav_15" >
      
      
      
      
        <label class="md-nav__link" for="__nav_15">
          VS Code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="VS Code" data-md-level="1">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          VS Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../vscode/vscode/" class="md-nav__link">
        VS Code - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_16" type="checkbox" id="__nav_16" >
      
      
      
      
        <label class="md-nav__link" for="__nav_16">
          Windows
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Windows" data-md-level="1">
        <label class="md-nav__title" for="__nav_16">
          <span class="md-nav__icon md-icon"></span>
          Windows
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../windows/windows/" class="md-nav__link">
        Windows - Misc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#first-use" class="md-nav__link">
    First use
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-image" class="md-nav__link">
    Custom image
  </a>
  
    <nav class="md-nav" aria-label="Custom image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#context-and-dockerfile" class="md-nav__link">
    Context and Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arguments" class="md-nav__link">
    Arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labels" class="md-nav__link">
    Labels
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ports" class="md-nav__link">
    Ports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    Volumes
  </a>
  
    <nav class="md-nav" aria-label="Volumes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bind" class="md-nav__link">
    Bind
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volumes_1" class="md-nav__link">
    Volumes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    Environment Variables
  </a>
  
    <nav class="md-nav" aria-label="Environment Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-cli" class="md-nav__link">
    from cli
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-compose-file" class="md-nav__link">
    from compose file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-env-file" class="md-nav__link">
    from .env file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network" class="md-nav__link">
    Network
  </a>
  
    <nav class="md-nav" aria-label="Network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default" class="md-nav__link">
    Default
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#links" class="md-nav__link">
    Links
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#name" class="md-nav__link">
    Name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networks" class="md-nav__link">
    Networks
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-application" class="md-nav__link">
    Sample application
  </a>
  
    <nav class="md-nav" aria-label="Sample application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mongodb" class="md-nav__link">
    MongoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nodejs" class="md-nav__link">
    Node.js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#depends-and-restart" class="md-nav__link">
    Depends and Restart
  </a>
  
    <nav class="md-nav" aria-label="Depends and Restart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#depends" class="md-nav__link">
    Depends
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restart" class="md-nav__link">
    Restart
  </a>
  
    <nav class="md-nav" aria-label="Restart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no" class="md-nav__link">
    no
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#always" class="md-nav__link">
    always
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#on-failure" class="md-nav__link">
    on-failure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unless-stopped" class="md-nav__link">
    unless-stopped
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-commands" class="md-nav__link">
    Other commands
  </a>
  
    <nav class="md-nav" aria-label="Other commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logs" class="md-nav__link">
    logs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#top" class="md-nav__link">
    top
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc" class="md-nav__link">
    misc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-push" class="md-nav__link">
    pull push
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="compose-08-use">Compose - 08 - Use</h1>
<p>Docker Compose - Use</p>
<hr />
<h2 id="introduction">Introduction</h2>
<p>Application =  </p>
<ul>
<li>Container Web server +  </li>
<li>Container Database  </li>
</ul>
<p>Setup:  </p>
<ul>
<li>Ports  </li>
<li>Volumes  </li>
<li>Network  </li>
<li>Environment  </li>
</ul>
<p>Docker Compose, talking about service.</p>
<p>One Application = (is composed of) Many Services (containers that communicate with each others).</p>
<p>Docker Compose is a CLI that read 'docker-compose.yml' file.</p>
<p>First, install Docker Compose and check installation and version by typing in a terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="go">docker-compose version</span>
</code></pre></div>
<hr />
<h2 id="first-use">First use</h2>
<p>'docker-compose ..' command(s) always refer to folder from where command is launched and context of 'docker-compose.yml' file contained in folder.</p>
<p>Yaml format configuration file.<br />
Yaml syntax is based on an indented key value format.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="go">touch docker-compose.yml</span>
</code></pre></div>
<p>First, mention version to use to ensure retro-compatibility.
To determine which version to specify in 'docker-compose.yml' file header, refer to docker engine version that run on your host machine:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="go">docker version</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="go">...</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="go">Server: Docker Engine - Community</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="go"> Engine:</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="go">  Version:          20.10.11</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="go">...</span>
</code></pre></div>
<p>Then refer to documentation<br />
<a href="https://docs.docker.com/compose/compose-file/">Compose file - Reference and guidelines</a></p>
<p>Second, specify service(s).</p>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>  <span class="nt">myalpine</span><span class="p">:</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="go">docker-compose up</span>
</code></pre></div>
<p>Alternative to go straight in service's container:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="go">docker-compose run myapline</span>
</code></pre></div>
<p>In another console:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="go">docker-compose ps -a</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="go">docker-compose down</span>
</code></pre></div>
<p>Particularity of 'docker-compose down' command is to suppress (don't just stop) all container and network that was launched by previous 'docker-compose up' command.<br />
Anonymous volumes are never reused by Docker Compose. It launches new ones each time if declared in configuration.</p>
<p>Default command is the one defined in image, for 'alpine' it's '/bin/sh'.<br />
To overwrite default command, specify it in 'docker-compose.yml' file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>  <span class="nt">myalpine</span><span class="p">:</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ls</span>
</code></pre></div>
<p>Or by adding command directly after service name in run command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="go">docker-compose run myalpine ls</span>
</code></pre></div>
<p>Or with entry point in exec form (instead of shell) in 'docker-compose.yml' file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>  <span class="nt">myalpine</span><span class="p">:</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>    <span class="nt">entrypoint</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>Or 'command: ["ls"]' instead of 'entrypoint: ["ls"]'</p>
<hr />
<h2 id="custom-image">Custom image</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="go">touch Dockerfile</span>
</code></pre></div>
<p>Dockerfile:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a>FROM alpine
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>CMD [&quot;/bin/sh&quot;]
</code></pre></div>
<p>docker-compose.yml</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>    <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="go">docker-compose build</span>
</code></pre></div>
<p>Have a look to VS Code Docker plugin to have a synthetic view of all Docker ecosystem components, containers, images, network, etc.</p>
<h3 id="context-and-dockerfile">Context and Dockerfile</h3>
<p>Specify a context and Dockerfile:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="go">mkdir backend</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="go">cp Dockerfile backend/DockerfileBackend</span>
</code></pre></div>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
</code></pre></div>
<h3 id="arguments">Arguments</h3>
<p>Passing arguments, e.g. create a folder at build, 'Dockerfile' receive args from 'docker-compose.yml'.<br />
DockerfileBackend:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a>FROM alpine
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>ARG FOLDER
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>RUN mkdir $FOLDER
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>CMD [&quot;/bin/sh&quot;]
</code></pre></div>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">FOLDER=test</span>
</code></pre></div>
<p>Note the 'arg' indentation with '-' for an array of values (yaml syntax).</p>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="go">docker-compose build</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="go">docker-compose run b</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="go">ls</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="go">.. test ..</span>
</code></pre></div>
<p>Instead of list (- FOLDER=), e.g. for 'args' you may also use an object instead (FOLDER:).
docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="go">docker-compose build</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="go">docker-compose run b</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="go">ls</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="go">.. myfolder ..</span>
</code></pre></div>
<h3 id="labels">Labels</h3>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">FOLDER=test</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="go">docker-compose build</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="go">docker image inspect compose_b:latest | grep EMAIL</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="go">                &quot;EMAIL&quot;: &quot;toto@test.com&quot;</span>
</code></pre></div>
<hr />
<h2 id="ports">Ports</h2>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
</code></pre></div>
<hr />
<h2 id="volumes">Volumes</h2>
<h3 id="bind">Bind</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="go">mkdir data</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="go">touch data/hello.txt</span>
</code></pre></div>
<p>DockerfileBackend.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a>FROM alpine
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>ARG FOLDER
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>WORKDIR /app
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>RUN mkdir $FOLDER
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>CMD [&quot;/bin/sh&quot;]
</code></pre></div>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="go">docker-compose build</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="go">docker-compose run b</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="go">cd data</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="go">ls</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="go">exit </span>
</code></pre></div>
<h3 id="volumes_1">Volumes</h3>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-28-18" name="__codelineno-28-18"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-28-19" name="__codelineno-28-19"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-28-20" name="__codelineno-28-20"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-28-21" name="__codelineno-28-21"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-28-22" name="__codelineno-28-22"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-28-23" name="__codelineno-28-23"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-28-24" name="__codelineno-28-24"></a>
<a id="__codelineno-28-25" name="__codelineno-28-25"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-28-26" name="__codelineno-28-26"></a>  <span class="nt">datavolume</span><span class="p">:</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="go">docker-compose build</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="go">docker-compose run b</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="go">[+] Running 1/0</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="go">  Volume &quot;compose_datavolume&quot;  Created</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="go">ls</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="go">data        datavolume  myfolder</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="go">exit </span>
</code></pre></div>
<p>Volume option external to avoid docker-compose to create volume if it does not exist.<br />
docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-30-12" name="__codelineno-30-12"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-30-13" name="__codelineno-30-13"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-30-14" name="__codelineno-30-14"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-30-15" name="__codelineno-30-15"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-30-16" name="__codelineno-30-16"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-30-17" name="__codelineno-30-17"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-30-18" name="__codelineno-30-18"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-30-19" name="__codelineno-30-19"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-30-20" name="__codelineno-30-20"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-30-21" name="__codelineno-30-21"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-30-22" name="__codelineno-30-22"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-30-23" name="__codelineno-30-23"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-30-24" name="__codelineno-30-24"></a>
<a id="__codelineno-30-25" name="__codelineno-30-25"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-30-26" name="__codelineno-30-26"></a>  <span class="nt">datavolume</span><span class="p">:</span>
<a id="__codelineno-30-27" name="__codelineno-30-27"></a>    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>Before testing remove previously created volumes.<br />
test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="go">docker-compose run b</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="go">external volume &quot;&quot; not found</span>
</code></pre></div>
<p>To create anonymous volume, omit source option.<br />
docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-32-16" name="__codelineno-32-16"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-32-17" name="__codelineno-32-17"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-32-18" name="__codelineno-32-18"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-32-19" name="__codelineno-32-19"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-32-20" name="__codelineno-32-20"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-32-21" name="__codelineno-32-21"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-32-22" name="__codelineno-32-22"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-32-23" name="__codelineno-32-23"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-32-24" name="__codelineno-32-24"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-32-25" name="__codelineno-32-25"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolumeanonymous</span>
<a id="__codelineno-32-26" name="__codelineno-32-26"></a>
<a id="__codelineno-32-27" name="__codelineno-32-27"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-32-28" name="__codelineno-32-28"></a>  <span class="nt">datavolume</span><span class="p">:</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="go">docker-compose build</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="go">docker-compose run b</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="go">ls</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="go">data                 datavolume           datavolumeanonymous  myfolder</span>
</code></pre></div>
<p>Docker Compose does not always use the same anonymous volume for a service.<br />
Therefore, it is advisable to use:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="go">docker-compose down -v</span>
</code></pre></div>
<p>to remove it.</p>
<p>-v, --volumes volumes, Remove named volumes declared in the volumes section of the Compose file and anonymous volumes attached to containers.</p>
<hr />
<h2 id="environment-variables">Environment Variables</h2>
<h3 id="from-cli">from cli</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="go">docker-compose run b</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="go">env</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="go">HOSTNAME=0b9907714155</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="go">SHLVL=1</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="go">HOME=/root</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="go">TERM=xterm</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="go">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="go">PWD=/app</span>
</code></pre></div>
<p>Add environnement variable from command line, value from host machine:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="go">docker-compose run -e USER b</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="go">env | grep USER</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="go">USER=toto</span>
</code></pre></div>
<p>By default, by not specifying a value, docker-compose search on host machine environnement variable and if find one that match, pass it (e.g. here with USER that do exist on host machine and has a value).</p>
<p>Add environnement variable from command line with specified value:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="go">docker-compose run -e USER=tintin b</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="go">env | grep USER</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="go">USER=tintin</span>
</code></pre></div>
<h3 id="from-compose-file">from compose file</h3>
<p>Without specifying a value (comes from host machine).<br />
docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">USER</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-38-15" name="__codelineno-38-15"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-38-16" name="__codelineno-38-16"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-38-17" name="__codelineno-38-17"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-38-18" name="__codelineno-38-18"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-38-19" name="__codelineno-38-19"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-38-20" name="__codelineno-38-20"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-38-21" name="__codelineno-38-21"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-38-22" name="__codelineno-38-22"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-38-23" name="__codelineno-38-23"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-38-24" name="__codelineno-38-24"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-38-25" name="__codelineno-38-25"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-38-26" name="__codelineno-38-26"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-38-27" name="__codelineno-38-27"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolumeanonymous</span>
<a id="__codelineno-38-28" name="__codelineno-38-28"></a>
<a id="__codelineno-38-29" name="__codelineno-38-29"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-38-30" name="__codelineno-38-30"></a>  <span class="nt">datavolume</span><span class="p">:</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="go">docker-compose build</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="go">docker-compose run b</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="go">env | grep USER</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="go">USER=toto</span>
</code></pre></div>
<p>By specifying a value.<br />
docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">USER=tintin</span>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-40-15" name="__codelineno-40-15"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-40-16" name="__codelineno-40-16"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-40-17" name="__codelineno-40-17"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-40-18" name="__codelineno-40-18"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-40-19" name="__codelineno-40-19"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-40-20" name="__codelineno-40-20"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-40-21" name="__codelineno-40-21"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-40-22" name="__codelineno-40-22"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-40-23" name="__codelineno-40-23"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-40-24" name="__codelineno-40-24"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-40-25" name="__codelineno-40-25"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-40-26" name="__codelineno-40-26"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-40-27" name="__codelineno-40-27"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolumeanonymous</span>
<a id="__codelineno-40-28" name="__codelineno-40-28"></a>
<a id="__codelineno-40-29" name="__codelineno-40-29"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-40-30" name="__codelineno-40-30"></a>  <span class="nt">datavolume</span><span class="p">:</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="go">docker-compose build</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="go">docker-compose run b</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="go">env | grep USER</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="go">USER=tintin</span>
</code></pre></div>
<h3 id="from-env-file">from .env file</h3>
<p>If value of environment variable is not specified, docker compose search for corresponding value in host machine, if not found, search then in '.env' file.<br />
.env:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a>NODE_ENV=development
</code></pre></div>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">NODE_ENV</span>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-43-18" name="__codelineno-43-18"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-43-19" name="__codelineno-43-19"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-43-20" name="__codelineno-43-20"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-43-21" name="__codelineno-43-21"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-43-22" name="__codelineno-43-22"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-43-23" name="__codelineno-43-23"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-43-24" name="__codelineno-43-24"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-43-25" name="__codelineno-43-25"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-43-26" name="__codelineno-43-26"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-43-27" name="__codelineno-43-27"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolumeanonymous</span>
<a id="__codelineno-43-28" name="__codelineno-43-28"></a>
<a id="__codelineno-43-29" name="__codelineno-43-29"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-43-30" name="__codelineno-43-30"></a>  <span class="nt">datavolume</span><span class="p">:</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="go">docker-compose build</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="go">docker-compose run b</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="go">env | grep NODE_ENV</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="go">NODE_ENV=development</span>
</code></pre></div>
<p>By specifying an environnement file, all variables contained in it will be imported in container.<br />
.env:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a>NODE_ENV=development
<a id="__codelineno-45-2" name="__codelineno-45-2"></a>TEST_ENV=test
</code></pre></div>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;ls&quot;</span><span class="p p-Indicator">]</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-46-8" name="__codelineno-46-8"></a>    <span class="nt">env_file</span><span class="p">:</span>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">.env</span>
<a id="__codelineno-46-10" name="__codelineno-46-10"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-46-11" name="__codelineno-46-11"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-46-12" name="__codelineno-46-12"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-46-13" name="__codelineno-46-13"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-46-14" name="__codelineno-46-14"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-46-15" name="__codelineno-46-15"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-46-16" name="__codelineno-46-16"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-46-17" name="__codelineno-46-17"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-46-18" name="__codelineno-46-18"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-46-19" name="__codelineno-46-19"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-46-20" name="__codelineno-46-20"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-46-21" name="__codelineno-46-21"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-46-22" name="__codelineno-46-22"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-46-23" name="__codelineno-46-23"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-46-24" name="__codelineno-46-24"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-46-25" name="__codelineno-46-25"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-46-26" name="__codelineno-46-26"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-46-27" name="__codelineno-46-27"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolumeanonymous</span>
<a id="__codelineno-46-28" name="__codelineno-46-28"></a>
<a id="__codelineno-46-29" name="__codelineno-46-29"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-46-30" name="__codelineno-46-30"></a>  <span class="nt">datavolume</span><span class="p">:</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="go">docker-compose build</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="go">docker-compose run b</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="go">env | grep _ENV</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="go">TEST_ENV=test</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a><span class="go">NODE_ENV=development</span>
</code></pre></div>
<p>You may have many environnement files.  </p>
<p>You may specify env file in command line, works only with 'up':</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="go">docker-compose --env-file ./.env up</span>
</code></pre></div>
<p>You may use both 'env_file' and 'environnement' for same service.</p>
<p>You may specify compose project name instead of current folder with, e.g. in .env file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a>COMPOSE_PROJECT_NAME=myproject
</code></pre></div>
<hr />
<h2 id="network">Network</h2>
<h3 id="default">Default</h3>
<p>By default docker compose create a network with folder name as a prefix, or with value of 'COMPOSE_PROJECT_NAME' key in project's environnement variable:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="go">docker-compose up</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="go">[+] Running 4/4</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="go">  Network myproject_default      Created</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="go"> ..</span>
</code></pre></div>
<p>Note that containers using the network appear in the list (docker network inspect myproject_default) only when they are running.</p>
<p>Below, we make a test with ping, note that we use shell form (instead of exec (cause:  executable file not found in $PATH: unknown)).<br />
docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ping b</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a>    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ping a</span>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-51-13" name="__codelineno-51-13"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-51-14" name="__codelineno-51-14"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-51-15" name="__codelineno-51-15"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-51-16" name="__codelineno-51-16"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-51-17" name="__codelineno-51-17"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-51-18" name="__codelineno-51-18"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-51-19" name="__codelineno-51-19"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-51-20" name="__codelineno-51-20"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-51-21" name="__codelineno-51-21"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-51-22" name="__codelineno-51-22"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-51-23" name="__codelineno-51-23"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-51-24" name="__codelineno-51-24"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-51-25" name="__codelineno-51-25"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-51-26" name="__codelineno-51-26"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolumeanonymous</span>
<a id="__codelineno-51-27" name="__codelineno-51-27"></a>
<a id="__codelineno-51-28" name="__codelineno-51-28"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-51-29" name="__codelineno-51-29"></a>  <span class="nt">datavolume</span><span class="p">:</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="go">docker-compose up</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="go">[+] Running 2/2</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="go">  Container myproject_a_1  Recreated                                                                                                                 0.2s</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a><span class="go">  Container myproject_b_1  Recreated                                                                                                                 0.2s </span>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="go">Attaching to a_1, b_1</span>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="go">a_1  | PING b (172.29.0.3): 56 data bytes</span>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a><span class="go">b_1  | PING a (172.29.0.2): 56 data bytes</span>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a><span class="go">a_1  | 64 bytes from 172.29.0.3: seq=0 ttl=64 time=188.846 ms</span>
<a id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="go">b_1  | 64 bytes from 172.29.0.2: seq=0 ttl=64 time=0.152 ms</span>
</code></pre></div>
<h3 id="links">Links</h3>
<p>Links from a container to another one.<br />
docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ping b</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a>    <span class="nt">links</span><span class="p">:</span>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a>      <span class="p p-Indicator">-</span> <span class="s">&quot;a:containerA&quot;</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a>    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ping containerA</span>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-53-14" name="__codelineno-53-14"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-53-15" name="__codelineno-53-15"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-53-16" name="__codelineno-53-16"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-53-17" name="__codelineno-53-17"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-53-18" name="__codelineno-53-18"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-53-19" name="__codelineno-53-19"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-53-20" name="__codelineno-53-20"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-53-21" name="__codelineno-53-21"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-53-22" name="__codelineno-53-22"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-53-23" name="__codelineno-53-23"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-53-24" name="__codelineno-53-24"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-53-25" name="__codelineno-53-25"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-53-26" name="__codelineno-53-26"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-53-27" name="__codelineno-53-27"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-53-28" name="__codelineno-53-28"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolumeanonymous</span>
<a id="__codelineno-53-29" name="__codelineno-53-29"></a>
<a id="__codelineno-53-30" name="__codelineno-53-30"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-53-31" name="__codelineno-53-31"></a>  <span class="nt">datavolume</span><span class="p">:</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="go">docker-compose up                                                                                       </span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="go">[+] Running 3/2</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="go">  Network myproject_default  Created                                                                                                                 0.0s </span>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="go">  Container myproject_a_1    Created                                                                                                                 0.8s </span>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="go">  Container myproject_b_1    Created                                                                                                                 0.1s</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="go">Attaching to a_1, b_1</span>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a><span class="go">b_1  | PING containerA (172.31.0.2): 56 data bytes</span>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a><span class="go">b_1  | 64 bytes from 172.31.0.2: seq=0 ttl=64 time=0.078 ms</span>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a><span class="go">b_1  | 64 bytes from 172.31.0.2: seq=1 ttl=64 time=0.190 ms</span>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a><span class="go">b_1  | 64 bytes from 172.31.0.2: seq=2 ttl=64 time=0.220 ms</span>
<a id="__codelineno-54-11" name="__codelineno-54-11"></a><span class="go">a_1  | PING b (172.31.0.3): 56 data bytes</span>
<a id="__codelineno-54-12" name="__codelineno-54-12"></a><span class="go">a_1  | 64 bytes from 172.31.0.3: seq=0 ttl=64 time=0.407 ms</span>
<a id="__codelineno-54-13" name="__codelineno-54-13"></a><span class="go">b_1  | 64 bytes from 172.31.0.2: seq=3 ttl=64 time=0.305 ms</span>
</code></pre></div>
<p>test to ping a and containerA from b:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="go">docker-compose up -d</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="go">docker-compose exec b sh</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="go">ping a</span>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="go">PING a (172.31.0.2): 56 data bytes</span>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="go">64 bytes from 172.31.0.2: seq=0 ttl=64 time=0.181 ms</span>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a><span class="go">..</span>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a><span class="go">ping containerA</span>
<a id="__codelineno-55-8" name="__codelineno-55-8"></a><span class="go">PING containerA (172.31.0.2): 56 data bytes</span>
<a id="__codelineno-55-9" name="__codelineno-55-9"></a><span class="go">64 bytes from 172.31.0.2: seq=0 ttl=64 time=0.287 ms</span>
</code></pre></div>
<h3 id="name">Name</h3>
<p>Give network a name to replace the default one.</p>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ping b</span>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a>    <span class="nt">links</span><span class="p">:</span>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a>      <span class="p p-Indicator">-</span> <span class="s">&quot;a:containerA&quot;</span>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a>    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ping containerA</span>
<a id="__codelineno-56-11" name="__codelineno-56-11"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-56-12" name="__codelineno-56-12"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-56-13" name="__codelineno-56-13"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-56-14" name="__codelineno-56-14"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-56-15" name="__codelineno-56-15"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-56-16" name="__codelineno-56-16"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-56-17" name="__codelineno-56-17"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-56-18" name="__codelineno-56-18"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-56-19" name="__codelineno-56-19"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-56-20" name="__codelineno-56-20"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-56-21" name="__codelineno-56-21"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-56-22" name="__codelineno-56-22"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-56-23" name="__codelineno-56-23"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-56-24" name="__codelineno-56-24"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-56-25" name="__codelineno-56-25"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-56-26" name="__codelineno-56-26"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-56-27" name="__codelineno-56-27"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-56-28" name="__codelineno-56-28"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolumeanonymous</span>
<a id="__codelineno-56-29" name="__codelineno-56-29"></a>
<a id="__codelineno-56-30" name="__codelineno-56-30"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-56-31" name="__codelineno-56-31"></a>  <span class="nt">datavolume</span><span class="p">:</span>
<a id="__codelineno-56-32" name="__codelineno-56-32"></a><span class="nt">networks</span><span class="p">:</span>
<a id="__codelineno-56-33" name="__codelineno-56-33"></a>  <span class="nt">default</span><span class="p">:</span>
<a id="__codelineno-56-34" name="__codelineno-56-34"></a>    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mynetwork</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="go">docker-compose up</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="go">[+] Running 3/3</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="go">  Network mynetwork        Created                                                                                                                0.0s</span>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="go">  Container myproject_a_1  Created                                                                                                                0.8s</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="go">  Container myproject_b_1  Created                                                                                                                2.4s</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a><span class="go">Attaching to a_1, b_1</span>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a><span class="go">b_1  | PING containerA (192.168.0.2): 56 data bytes</span>
<a id="__codelineno-57-8" name="__codelineno-57-8"></a><span class="go">b_1  | 64 bytes from 192.168.0.2: seq=0 ttl=64 time=0.081 ms</span>
<a id="__codelineno-57-9" name="__codelineno-57-9"></a><span class="go">b_1  | 64 bytes from 192.168.0.2: seq=1 ttl=64 time=0.088 ms</span>
<a id="__codelineno-57-10" name="__codelineno-57-10"></a><span class="go">b_1  | 64 bytes from 192.168.0.2: seq=2 ttl=64 time=0.122 ms</span>
<a id="__codelineno-57-11" name="__codelineno-57-11"></a><span class="go">a_1  | PING b (192.168.0.3): 56 data bytes</span>
<a id="__codelineno-57-12" name="__codelineno-57-12"></a><span class="go">a_1  | 64 bytes from 192.168.0.3: seq=0 ttl=64 time=0.339 ms</span>
</code></pre></div>
<h3 id="networks">Networks</h3>
<p>Link container to many networks with adding list in service configuration.<br />
docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ping b</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-58-9" name="__codelineno-58-9"></a>    <span class="nt">links</span><span class="p">:</span>
<a id="__codelineno-58-10" name="__codelineno-58-10"></a>      <span class="p p-Indicator">-</span> <span class="s">&quot;a:containerA&quot;</span>
<a id="__codelineno-58-11" name="__codelineno-58-11"></a>    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ping containerA</span>
<a id="__codelineno-58-12" name="__codelineno-58-12"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-58-13" name="__codelineno-58-13"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-58-15" name="__codelineno-58-15"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-58-16" name="__codelineno-58-16"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-58-17" name="__codelineno-58-17"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-58-18" name="__codelineno-58-18"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-58-19" name="__codelineno-58-19"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-58-20" name="__codelineno-58-20"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-58-21" name="__codelineno-58-21"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-58-22" name="__codelineno-58-22"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-58-23" name="__codelineno-58-23"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-58-24" name="__codelineno-58-24"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-58-25" name="__codelineno-58-25"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-58-26" name="__codelineno-58-26"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-58-27" name="__codelineno-58-27"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-58-28" name="__codelineno-58-28"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-58-29" name="__codelineno-58-29"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolumeanonymous</span>
<a id="__codelineno-58-30" name="__codelineno-58-30"></a>    <span class="nt">networks</span><span class="p">:</span>
<a id="__codelineno-58-31" name="__codelineno-58-31"></a>      <span class="p p-Indicator">-</span> <span class="s">&#39;othernetwork&#39;</span>
<a id="__codelineno-58-32" name="__codelineno-58-32"></a>
<a id="__codelineno-58-33" name="__codelineno-58-33"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-58-34" name="__codelineno-58-34"></a>  <span class="nt">datavolume</span><span class="p">:</span>
<a id="__codelineno-58-35" name="__codelineno-58-35"></a><span class="nt">networks</span><span class="p">:</span>
<a id="__codelineno-58-36" name="__codelineno-58-36"></a>  <span class="nt">default</span><span class="p">:</span>
<a id="__codelineno-58-37" name="__codelineno-58-37"></a>    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mynetwork</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="go">docker-compose up</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="go">service &quot;b&quot; refers to undefined network othernetwork: invalid compose project</span>
</code></pre></div>
<p>Error due to othernetwork missing.<br />
We add it to networks section in configuration file and then to services.<br />
docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a>  <span class="nt">a</span><span class="p">:</span>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
<a id="__codelineno-60-6" name="__codelineno-60-6"></a>    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ping b</span>
<a id="__codelineno-60-7" name="__codelineno-60-7"></a>    <span class="nt">networks</span><span class="p">:</span>
<a id="__codelineno-60-8" name="__codelineno-60-8"></a>      <span class="p p-Indicator">-</span> <span class="s">&#39;othernetwork&#39;</span>
<a id="__codelineno-60-9" name="__codelineno-60-9"></a>
<a id="__codelineno-60-10" name="__codelineno-60-10"></a>  <span class="nt">b</span><span class="p">:</span>
<a id="__codelineno-60-11" name="__codelineno-60-11"></a>    <span class="nt">links</span><span class="p">:</span>
<a id="__codelineno-60-12" name="__codelineno-60-12"></a>      <span class="p p-Indicator">-</span> <span class="s">&quot;a:containerA&quot;</span>
<a id="__codelineno-60-13" name="__codelineno-60-13"></a>    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ping containerA</span>
<a id="__codelineno-60-14" name="__codelineno-60-14"></a>    <span class="nt">build</span><span class="p">:</span>
<a id="__codelineno-60-15" name="__codelineno-60-15"></a>      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./backend</span>
<a id="__codelineno-60-16" name="__codelineno-60-16"></a>      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DockerfileBackend</span>
<a id="__codelineno-60-17" name="__codelineno-60-17"></a>      <span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-60-18" name="__codelineno-60-18"></a>        <span class="nt">FOLDER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myfolder</span>
<a id="__codelineno-60-19" name="__codelineno-60-19"></a>      <span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-60-20" name="__codelineno-60-20"></a>        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL=toto@test.com</span>
<a id="__codelineno-60-21" name="__codelineno-60-21"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-60-22" name="__codelineno-60-22"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-60-23" name="__codelineno-60-23"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-60-24" name="__codelineno-60-24"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-60-25" name="__codelineno-60-25"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./data</span>
<a id="__codelineno-60-26" name="__codelineno-60-26"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/data</span>
<a id="__codelineno-60-27" name="__codelineno-60-27"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-60-28" name="__codelineno-60-28"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datavolume</span>
<a id="__codelineno-60-29" name="__codelineno-60-29"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolume</span>
<a id="__codelineno-60-30" name="__codelineno-60-30"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-60-31" name="__codelineno-60-31"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/datavolumeanonymous</span>
<a id="__codelineno-60-32" name="__codelineno-60-32"></a>    <span class="nt">networks</span><span class="p">:</span>
<a id="__codelineno-60-33" name="__codelineno-60-33"></a>      <span class="p p-Indicator">-</span> <span class="s">&#39;othernetwork&#39;</span>
<a id="__codelineno-60-34" name="__codelineno-60-34"></a>
<a id="__codelineno-60-35" name="__codelineno-60-35"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-60-36" name="__codelineno-60-36"></a>  <span class="nt">datavolume</span><span class="p">:</span>
<a id="__codelineno-60-37" name="__codelineno-60-37"></a><span class="nt">networks</span><span class="p">:</span>
<a id="__codelineno-60-38" name="__codelineno-60-38"></a>  <span class="nt">default</span><span class="p">:</span>
<a id="__codelineno-60-39" name="__codelineno-60-39"></a>    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mynetwork</span>
<a id="__codelineno-60-40" name="__codelineno-60-40"></a>  <span class="nt">othernetwork</span><span class="p">:</span>
<a id="__codelineno-60-41" name="__codelineno-60-41"></a>    <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bridge</span>
</code></pre></div>
<p>test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="go">docker-compose up</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="go">[+] Running 3/3</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="go">  Network myproject_othernetwork  Created                                                                                                          0.0s </span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="go">  Container myproject_a_1         Created                                                                                                          0.1s </span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="go">  Container myproject_b_1         Created                                                                                                          0.1s </span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="go">Attaching to a_1, b_1</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a><span class="go">b_1  | PING containerA (192.168.48.2): 56 data bytes</span>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="go">b_1  | 64 bytes from 192.168.48.2: seq=0 ttl=64 time=0.122 ms</span>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a><span class="go">b_1  | 64 bytes from 192.168.48.2: seq=1 ttl=64 time=0.051 ms</span>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="go">b_1  | 64 bytes from 192.168.48.2: seq=2 ttl=64 time=0.196 ms</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a><span class="go">a_1  | PING b (192.168.48.3): 56 data bytes</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a><span class="go">a_1  | 64 bytes from 192.168.48.3: seq=0 ttl=64 time=0.252 ms</span>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a><span class="go">b_1  | 64 bytes from 192.168.48.2: seq=3 ttl=64 time=0.200 ms</span>
</code></pre></div>
<hr />
<h2 id="sample-application">Sample application</h2>
<p>Node.js application that increment a counter in a MongoDB.</p>
<h3 id="mongodb">MongoDB</h3>
<p>We provide volume to handle db data, so, preamble is to "manually" create the needed volume:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="go">docker volume create mydb</span>
</code></pre></div>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a>  <span class="nt">db</span><span class="p">:</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mydb</span>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a>  <span class="nt">mydb</span><span class="p">:</span>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a>    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>We run db individually to initialize it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="go">docker-compose run -d db</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="go">39cf..</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="go">docker container exec -it 39cf sh</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="go">mongo</span>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="go">&gt; use test</span>
<a id="__codelineno-64-6" name="__codelineno-64-6"></a><span class="go">&gt; db.count.insertOne({ count: 0 })</span>
<a id="__codelineno-64-7" name="__codelineno-64-7"></a><span class="go">{</span>
<a id="__codelineno-64-8" name="__codelineno-64-8"></a><span class="go">        &quot;acknowledged&quot; : true,</span>
<a id="__codelineno-64-9" name="__codelineno-64-9"></a><span class="go">        &quot;insertedId&quot; : ObjectId(&quot;61d1a03ac9a303a408034aca&quot;)</span>
<a id="__codelineno-64-10" name="__codelineno-64-10"></a><span class="go">}</span>
<a id="__codelineno-64-11" name="__codelineno-64-11"></a><span class="go">&gt; db.count.findOne()</span>
<a id="__codelineno-64-12" name="__codelineno-64-12"></a><span class="go">{ &quot;_id&quot; : ObjectId(&quot;61d1a03ac9a303a408034aca&quot;), &quot;count&quot; : 0 }</span>
<a id="__codelineno-64-13" name="__codelineno-64-13"></a><span class="go">&gt; exit</span>
<a id="__codelineno-64-14" name="__codelineno-64-14"></a><span class="go">bye</span>
<a id="__codelineno-64-15" name="__codelineno-64-15"></a><span class="go">exit</span>
<a id="__codelineno-64-16" name="__codelineno-64-16"></a><span class="go">docker container stop 39cf</span>
</code></pre></div>
<p>In MongoDB, volume that contain the database may not be mounted anywhere.<br />
MongoDB will specifically search for database in '/data/db' folder.</p>
<p>No need to open specific port(s) for containers that run on same network.<br />
By default all ports are available for containers that run on same network.</p>
<h3 id="nodejs">Node.js</h3>
<p>Dockerfile:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a>FROM node:alpine
<a id="__codelineno-65-2" name="__codelineno-65-2"></a>WORKDIR /app
<a id="__codelineno-65-3" name="__codelineno-65-3"></a>COPY ./package.json .
<a id="__codelineno-65-4" name="__codelineno-65-4"></a>RUN npm install
<a id="__codelineno-65-5" name="__codelineno-65-5"></a>COPY . .
<a id="__codelineno-65-6" name="__codelineno-65-6"></a>ENV PATH=$PATH:/app/node_modules/.bin
<a id="__codelineno-65-7" name="__codelineno-65-7"></a>CMD [&quot;nodemon&quot;, &quot;-L&quot;, &quot;src/app.js&quot;]
</code></pre></div>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a>
<a id="__codelineno-66-5" name="__codelineno-66-5"></a>  <span class="nt">db</span><span class="p">:</span>
<a id="__codelineno-66-6" name="__codelineno-66-6"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
<a id="__codelineno-66-7" name="__codelineno-66-7"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-66-8" name="__codelineno-66-8"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-66-9" name="__codelineno-66-9"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mydb</span>
<a id="__codelineno-66-10" name="__codelineno-66-10"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
<a id="__codelineno-66-11" name="__codelineno-66-11"></a>
<a id="__codelineno-66-12" name="__codelineno-66-12"></a>  <span class="nt">server</span><span class="p">:</span>
<a id="__codelineno-66-13" name="__codelineno-66-13"></a>    <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-66-14" name="__codelineno-66-14"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-66-15" name="__codelineno-66-15"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-66-16" name="__codelineno-66-16"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-66-17" name="__codelineno-66-17"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-66-18" name="__codelineno-66-18"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src</span>
<a id="__codelineno-66-19" name="__codelineno-66-19"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/src</span>
<a id="__codelineno-66-20" name="__codelineno-66-20"></a>
<a id="__codelineno-66-21" name="__codelineno-66-21"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-66-22" name="__codelineno-66-22"></a>  <span class="nt">mydb</span><span class="p">:</span>
<a id="__codelineno-66-23" name="__codelineno-66-23"></a>    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>\src\app.js:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;console-stamp&#39;</span> <span class="p">)(</span> <span class="nx">console</span> <span class="p">);</span>  <span class="c1">// to add timestamp in logs</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">);</span>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a>
<a id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="kd">const</span> <span class="nx">MongoClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongodb&#39;</span><span class="p">).</span><span class="nx">MongoClient</span><span class="p">;</span>
<a id="__codelineno-67-6" name="__codelineno-67-6"></a>
<a id="__codelineno-67-7" name="__codelineno-67-7"></a><span class="kd">let</span> <span class="nx">count</span><span class="p">;</span>
<a id="__codelineno-67-8" name="__codelineno-67-8"></a>
<a id="__codelineno-67-9" name="__codelineno-67-9"></a><span class="nx">MongoClient</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">&#39;mongodb://db&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">client</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-67-10" name="__codelineno-67-10"></a>  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-67-11" name="__codelineno-67-11"></a>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<a id="__codelineno-67-12" name="__codelineno-67-12"></a>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-67-13" name="__codelineno-67-13"></a>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;CONNEXION DB OK!&#39;</span><span class="p">);</span>
<a id="__codelineno-67-14" name="__codelineno-67-14"></a>    <span class="nx">count</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">db</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">).</span><span class="nx">collection</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">);</span>
<a id="__codelineno-67-15" name="__codelineno-67-15"></a>  <span class="p">}</span>
<a id="__codelineno-67-16" name="__codelineno-67-16"></a><span class="p">});</span>
<a id="__codelineno-67-17" name="__codelineno-67-17"></a>
<a id="__codelineno-67-18" name="__codelineno-67-18"></a><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<a id="__codelineno-67-19" name="__codelineno-67-19"></a>
<a id="__codelineno-67-20" name="__codelineno-67-20"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-67-21" name="__codelineno-67-21"></a>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;request url: &#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<a id="__codelineno-67-22" name="__codelineno-67-22"></a>  <span class="nx">count</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">({},</span> <span class="p">{</span> <span class="nx">$inc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">count</span><span class="o">:</span> <span class="mf">1</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">returnNewDocument</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">doc</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-67-23" name="__codelineno-67-23"></a>    <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<a id="__codelineno-67-24" name="__codelineno-67-24"></a>    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
<a id="__codelineno-67-25" name="__codelineno-67-25"></a>  <span class="p">})</span>
<a id="__codelineno-67-26" name="__codelineno-67-26"></a><span class="p">});</span>
<a id="__codelineno-67-27" name="__codelineno-67-27"></a>
<a id="__codelineno-67-28" name="__codelineno-67-28"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-67-29" name="__codelineno-67-29"></a>  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<a id="__codelineno-67-30" name="__codelineno-67-30"></a><span class="p">});</span>
<a id="__codelineno-67-31" name="__codelineno-67-31"></a>
<a id="__codelineno-67-32" name="__codelineno-67-32"></a><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">80</span><span class="p">);</span>
</code></pre></div>
<p>In a terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="go">docker-compose up</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="go">..</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="go">server_1  | [02.01.2022 17:10.30.697] [LOG]   CONNEXION DB OK!</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="go">..</span>
</code></pre></div>
<p>In a browser:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a>http://localhost/
</code></pre></div>
<h3 id="authentication">Authentication</h3>
<p>We add authentication through environnement variable to MongoDB.</p>
<p>Clear docker environnement and recreate database volume:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="go">docker container prune</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="go">docker volume prune</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="go">docker volume create mydb</span>
</code></pre></div>
<p><a href="https://hub.docker.com/_/mongo#:~:text=mongo/mongod.conf-,Environment%20Variables,-When%20you%20start">Have a look to MongoDB official image on Docker Hub</a><br />
What's interesting us here is to set the two following environnement variables:  </p>
<ul>
<li>MONGO_INITDB_ROOT_USERNAME  </li>
<li>MONGO_INITDB_ROOT_PASSWORD  </li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="go">touch .env</span>
</code></pre></div>
<p>.env:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a>MONGO_INITDB_ROOT_USERNAME=toto
<a id="__codelineno-72-2" name="__codelineno-72-2"></a>MONGO_INITDB_ROOT_PASSWORD=123
</code></pre></div>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-73-4" name="__codelineno-73-4"></a>
<a id="__codelineno-73-5" name="__codelineno-73-5"></a>  <span class="nt">db</span><span class="p">:</span>
<a id="__codelineno-73-6" name="__codelineno-73-6"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-73-7" name="__codelineno-73-7"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_USERNAME</span>
<a id="__codelineno-73-8" name="__codelineno-73-8"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_PASSWORD</span>
<a id="__codelineno-73-9" name="__codelineno-73-9"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
<a id="__codelineno-73-10" name="__codelineno-73-10"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-73-11" name="__codelineno-73-11"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-73-12" name="__codelineno-73-12"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mydb</span>
<a id="__codelineno-73-13" name="__codelineno-73-13"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
<a id="__codelineno-73-14" name="__codelineno-73-14"></a>
<a id="__codelineno-73-15" name="__codelineno-73-15"></a>  <span class="nt">server</span><span class="p">:</span>
<a id="__codelineno-73-16" name="__codelineno-73-16"></a>    <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-73-17" name="__codelineno-73-17"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-73-18" name="__codelineno-73-18"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-73-19" name="__codelineno-73-19"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-73-20" name="__codelineno-73-20"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-73-21" name="__codelineno-73-21"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src</span>
<a id="__codelineno-73-22" name="__codelineno-73-22"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/src</span>
<a id="__codelineno-73-23" name="__codelineno-73-23"></a>
<a id="__codelineno-73-24" name="__codelineno-73-24"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-73-25" name="__codelineno-73-25"></a>  <span class="nt">mydb</span><span class="p">:</span>
<a id="__codelineno-73-26" name="__codelineno-73-26"></a>    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>In a terminal, set up db with authenticated user and then create a new user 'tintin' with password '456' and role 'readWrite' on db 'test':</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="go">docker-compose run -d db</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="go">bad88..</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a><span class="go">docker exec -it bad88 sh</span>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a><span class="go">mongo</span>
<a id="__codelineno-74-5" name="__codelineno-74-5"></a><span class="go">&gt; use test</span>
<a id="__codelineno-74-6" name="__codelineno-74-6"></a><span class="go">&gt; db.count.insertOne({ count: 0 })</span>
<a id="__codelineno-74-7" name="__codelineno-74-7"></a><span class="go">.. error.. command insert requires authentication..</span>
<a id="__codelineno-74-8" name="__codelineno-74-8"></a><span class="go">&gt; use admin</span>
<a id="__codelineno-74-9" name="__codelineno-74-9"></a><span class="go">&gt; db.auth({ user: &#39;toto&#39;, pwd: &#39;123&#39; })</span>
<a id="__codelineno-74-10" name="__codelineno-74-10"></a><span class="go">1</span>
<a id="__codelineno-74-11" name="__codelineno-74-11"></a><span class="go">&gt; use test</span>
<a id="__codelineno-74-12" name="__codelineno-74-12"></a><span class="go">&gt; db.count.insertOne({ count: 0 })</span>
<a id="__codelineno-74-13" name="__codelineno-74-13"></a><span class="go">{</span>
<a id="__codelineno-74-14" name="__codelineno-74-14"></a><span class="go">        &quot;acknowledged&quot; : true,</span>
<a id="__codelineno-74-15" name="__codelineno-74-15"></a><span class="go">        &quot;insertedId&quot; : ObjectId(&quot;61d1e40276df2cfd1b903a8f&quot;)</span>
<a id="__codelineno-74-16" name="__codelineno-74-16"></a><span class="go">}</span>
<a id="__codelineno-74-17" name="__codelineno-74-17"></a><span class="go">&gt; db.count.findOne()</span>
<a id="__codelineno-74-18" name="__codelineno-74-18"></a><span class="go">{ &quot;_id&quot; : ObjectId(&quot;61d1e40276df2cfd1b903a8f&quot;), &quot;count&quot; : 0 }</span>
<a id="__codelineno-74-19" name="__codelineno-74-19"></a><span class="go">&gt; use admin</span>
<a id="__codelineno-74-20" name="__codelineno-74-20"></a><span class="go">switched to db admin</span>
<a id="__codelineno-74-21" name="__codelineno-74-21"></a><span class="go">&gt; db.createUser({ user: &#39;tintin&#39;, pwd: &#39;456&#39;, roles: [{ role: &#39;readWrite&#39;, db: &#39;test&#39; }] })</span>
<a id="__codelineno-74-22" name="__codelineno-74-22"></a><span class="go">Successfully added user: {</span>
<a id="__codelineno-74-23" name="__codelineno-74-23"></a><span class="go">        &quot;user&quot; : &quot;tintin&quot;,</span>
<a id="__codelineno-74-24" name="__codelineno-74-24"></a><span class="go">        &quot;roles&quot; : [</span>
<a id="__codelineno-74-25" name="__codelineno-74-25"></a><span class="go">                {</span>
<a id="__codelineno-74-26" name="__codelineno-74-26"></a><span class="go">                        &quot;role&quot; : &quot;readWrite&quot;,</span>
<a id="__codelineno-74-27" name="__codelineno-74-27"></a><span class="go">                        &quot;db&quot; : &quot;test&quot;        </span>
<a id="__codelineno-74-28" name="__codelineno-74-28"></a><span class="go">                }</span>
<a id="__codelineno-74-29" name="__codelineno-74-29"></a><span class="go">        ]</span>
<a id="__codelineno-74-30" name="__codelineno-74-30"></a><span class="go">}</span>
<a id="__codelineno-74-31" name="__codelineno-74-31"></a><span class="go">&gt; exit</span>
<a id="__codelineno-74-32" name="__codelineno-74-32"></a><span class="go">bye</span>
<a id="__codelineno-74-33" name="__codelineno-74-33"></a><span class="go">exit</span>
<a id="__codelineno-74-34" name="__codelineno-74-34"></a><span class="go">docker stop bad88</span>
</code></pre></div>
<p>Check that connection to db is OK ('CONNECTION DB OK!' in logs), but we cannot access data (trying to refresh 'localhost' in Internet browser), due to unauthenticated connection:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="go">docker-compose up</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a><span class="go">..</span>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a><span class="go">server_1  | [02.01.2022 19:47.14.606] [LOG]   CONNECTION DB OK!</span>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a><span class="go">..</span>
<a id="__codelineno-75-5" name="__codelineno-75-5"></a><span class="go">server_1  | MongoError: command findAndModify requires authentication</span>
<a id="__codelineno-75-6" name="__codelineno-75-6"></a><span class="go">..</span>
</code></pre></div>
<p>We can authenticate with many different ways.</p>
<p>By specifying (hard coded) user password directly in 'app.js' file ('mongodb://tintin:456@db').<br />
We also add a 'console.log(process)' to have environnement variables in logs.<br />
app.js:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;console-stamp&#39;</span> <span class="p">)(</span> <span class="nx">console</span> <span class="p">);</span>  <span class="c1">// to add timestamp in logs</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">);</span>
<a id="__codelineno-76-4" name="__codelineno-76-4"></a>
<a id="__codelineno-76-5" name="__codelineno-76-5"></a><span class="kd">const</span> <span class="nx">MongoClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongodb&#39;</span><span class="p">).</span><span class="nx">MongoClient</span><span class="p">;</span>
<a id="__codelineno-76-6" name="__codelineno-76-6"></a>
<a id="__codelineno-76-7" name="__codelineno-76-7"></a><span class="kd">let</span> <span class="nx">count</span><span class="p">;</span>
<a id="__codelineno-76-8" name="__codelineno-76-8"></a>
<a id="__codelineno-76-9" name="__codelineno-76-9"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">process</span><span class="p">)</span> <span class="c1">// to have environnement variables in logs</span>
<a id="__codelineno-76-10" name="__codelineno-76-10"></a>
<a id="__codelineno-76-11" name="__codelineno-76-11"></a><span class="nx">MongoClient</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">&#39;mongodb://tintin:456@db&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">client</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-76-12" name="__codelineno-76-12"></a>  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-76-13" name="__codelineno-76-13"></a>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<a id="__codelineno-76-14" name="__codelineno-76-14"></a>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-76-15" name="__codelineno-76-15"></a>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;CONNECTION DB OK!&#39;</span><span class="p">);</span>
<a id="__codelineno-76-16" name="__codelineno-76-16"></a>    <span class="nx">count</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">db</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">).</span><span class="nx">collection</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">);</span>
<a id="__codelineno-76-17" name="__codelineno-76-17"></a>  <span class="p">}</span>
<a id="__codelineno-76-18" name="__codelineno-76-18"></a><span class="p">});</span>
<a id="__codelineno-76-19" name="__codelineno-76-19"></a>
<a id="__codelineno-76-20" name="__codelineno-76-20"></a><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<a id="__codelineno-76-21" name="__codelineno-76-21"></a>
<a id="__codelineno-76-22" name="__codelineno-76-22"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-76-23" name="__codelineno-76-23"></a>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;request url: &#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<a id="__codelineno-76-24" name="__codelineno-76-24"></a>  <span class="nx">count</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">({},</span> <span class="p">{</span> <span class="nx">$inc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">count</span><span class="o">:</span> <span class="mf">1</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">returnNewDocument</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">doc</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-76-25" name="__codelineno-76-25"></a>    <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<a id="__codelineno-76-26" name="__codelineno-76-26"></a>    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
<a id="__codelineno-76-27" name="__codelineno-76-27"></a>  <span class="p">})</span>
<a id="__codelineno-76-28" name="__codelineno-76-28"></a><span class="p">});</span>
<a id="__codelineno-76-29" name="__codelineno-76-29"></a>
<a id="__codelineno-76-30" name="__codelineno-76-30"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-76-31" name="__codelineno-76-31"></a>  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<a id="__codelineno-76-32" name="__codelineno-76-32"></a><span class="p">});</span>
<a id="__codelineno-76-33" name="__codelineno-76-33"></a>
<a id="__codelineno-76-34" name="__codelineno-76-34"></a><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">80</span><span class="p">);</span>
</code></pre></div>
<p>server_1 logs (to see environnement variables):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="go">..</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="go">server_1  |   env: {</span>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a><span class="go">server_1  |     NODE_VERSION: &#39;17.3.0&#39;,</span>
<a id="__codelineno-77-4" name="__codelineno-77-4"></a><span class="go">server_1  |     HOSTNAME: &#39;fbdb8ee68893&#39;,</span>
<a id="__codelineno-77-5" name="__codelineno-77-5"></a><span class="go">server_1  |     YARN_VERSION: &#39;1.22.17&#39;,</span>
<a id="__codelineno-77-6" name="__codelineno-77-6"></a><span class="go">server_1  |     SHLVL: &#39;1&#39;,</span>
<a id="__codelineno-77-7" name="__codelineno-77-7"></a><span class="go">server_1  |     HOME: &#39;/root&#39;,</span>
<a id="__codelineno-77-8" name="__codelineno-77-8"></a><span class="go">server_1  |     PATH: &#39;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/app/node_modules/.bin&#39;,</span>
<a id="__codelineno-77-9" name="__codelineno-77-9"></a><span class="go">server_1  |     PWD: &#39;/app&#39;</span>
<a id="__codelineno-77-10" name="__codelineno-77-10"></a><span class="go">server_1  |   }</span>
<a id="__codelineno-77-11" name="__codelineno-77-11"></a><span class="go">..</span>
</code></pre></div>
<p>By refreshing Internet browser's page at localhost address, we may observer that application is now running fine.</p>
<p>Now we stop application by hitting 'Ctrl+c'.</p>
<p>Below is described a second manner (more secure, therefor, advised to use) to authenticate to 'db' service from 'sever' service through environnement variables.</p>
<p>.env:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a>MONGO_INITDB_ROOT_USERNAME=toto
<a id="__codelineno-78-2" name="__codelineno-78-2"></a>MONGO_INITDB_ROOT_PASSWORD=123
<a id="__codelineno-78-3" name="__codelineno-78-3"></a>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a>MONGO_USER_NAME=tintin
<a id="__codelineno-78-5" name="__codelineno-78-5"></a>MONGO_USER_PASSWORD=456
</code></pre></div>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-79-4" name="__codelineno-79-4"></a>
<a id="__codelineno-79-5" name="__codelineno-79-5"></a>  <span class="nt">db</span><span class="p">:</span>
<a id="__codelineno-79-6" name="__codelineno-79-6"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-79-7" name="__codelineno-79-7"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_USERNAME</span>
<a id="__codelineno-79-8" name="__codelineno-79-8"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_PASSWORD</span>
<a id="__codelineno-79-9" name="__codelineno-79-9"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
<a id="__codelineno-79-10" name="__codelineno-79-10"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-79-11" name="__codelineno-79-11"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-79-12" name="__codelineno-79-12"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mydb</span>
<a id="__codelineno-79-13" name="__codelineno-79-13"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
<a id="__codelineno-79-14" name="__codelineno-79-14"></a>
<a id="__codelineno-79-15" name="__codelineno-79-15"></a>  <span class="nt">server</span><span class="p">:</span>
<a id="__codelineno-79-16" name="__codelineno-79-16"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-79-17" name="__codelineno-79-17"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_NAME</span>
<a id="__codelineno-79-18" name="__codelineno-79-18"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_PASSWORD</span>
<a id="__codelineno-79-19" name="__codelineno-79-19"></a>    <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-79-20" name="__codelineno-79-20"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-79-21" name="__codelineno-79-21"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-79-22" name="__codelineno-79-22"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-79-23" name="__codelineno-79-23"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-79-24" name="__codelineno-79-24"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src</span>
<a id="__codelineno-79-25" name="__codelineno-79-25"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/src</span>
<a id="__codelineno-79-26" name="__codelineno-79-26"></a>
<a id="__codelineno-79-27" name="__codelineno-79-27"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-79-28" name="__codelineno-79-28"></a>  <span class="nt">mydb</span><span class="p">:</span>
<a id="__codelineno-79-29" name="__codelineno-79-29"></a>    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>app.js:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;console-stamp&#39;</span> <span class="p">)(</span> <span class="nx">console</span> <span class="p">);</span>  <span class="c1">// to add timestamp in logs</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a>
<a id="__codelineno-80-3" name="__codelineno-80-3"></a><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">);</span>
<a id="__codelineno-80-4" name="__codelineno-80-4"></a>
<a id="__codelineno-80-5" name="__codelineno-80-5"></a><span class="kd">const</span> <span class="nx">MongoClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongodb&#39;</span><span class="p">).</span><span class="nx">MongoClient</span><span class="p">;</span>
<a id="__codelineno-80-6" name="__codelineno-80-6"></a>
<a id="__codelineno-80-7" name="__codelineno-80-7"></a><span class="kd">let</span> <span class="nx">count</span><span class="p">;</span>
<a id="__codelineno-80-8" name="__codelineno-80-8"></a>
<a id="__codelineno-80-9" name="__codelineno-80-9"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">)</span> <span class="c1">// to have environnement variables in logs</span>
<a id="__codelineno-80-10" name="__codelineno-80-10"></a>
<a id="__codelineno-80-11" name="__codelineno-80-11"></a><span class="nx">MongoClient</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="sb">`mongodb://</span><span class="si">${</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGO_USER_NAME</span> <span class="si">}</span><span class="sb">:</span><span class="si">${</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGO_USER_PASSWORD</span> <span class="si">}</span><span class="sb">@db`</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">client</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-80-12" name="__codelineno-80-12"></a>  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-80-13" name="__codelineno-80-13"></a>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<a id="__codelineno-80-14" name="__codelineno-80-14"></a>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-80-15" name="__codelineno-80-15"></a>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;CONNECTION DB OK!&#39;</span><span class="p">);</span>
<a id="__codelineno-80-16" name="__codelineno-80-16"></a>    <span class="nx">count</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">db</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">).</span><span class="nx">collection</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">);</span>
<a id="__codelineno-80-17" name="__codelineno-80-17"></a>  <span class="p">}</span>
<a id="__codelineno-80-18" name="__codelineno-80-18"></a><span class="p">});</span>
<a id="__codelineno-80-19" name="__codelineno-80-19"></a>
<a id="__codelineno-80-20" name="__codelineno-80-20"></a><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<a id="__codelineno-80-21" name="__codelineno-80-21"></a>
<a id="__codelineno-80-22" name="__codelineno-80-22"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-80-23" name="__codelineno-80-23"></a>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;request url: &#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<a id="__codelineno-80-24" name="__codelineno-80-24"></a>  <span class="nx">count</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">({},</span> <span class="p">{</span> <span class="nx">$inc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">count</span><span class="o">:</span> <span class="mf">1</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">returnNewDocument</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">doc</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-80-25" name="__codelineno-80-25"></a>    <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<a id="__codelineno-80-26" name="__codelineno-80-26"></a>    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
<a id="__codelineno-80-27" name="__codelineno-80-27"></a>  <span class="p">})</span>
<a id="__codelineno-80-28" name="__codelineno-80-28"></a><span class="p">});</span>
<a id="__codelineno-80-29" name="__codelineno-80-29"></a>
<a id="__codelineno-80-30" name="__codelineno-80-30"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-80-31" name="__codelineno-80-31"></a>  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<a id="__codelineno-80-32" name="__codelineno-80-32"></a><span class="p">});</span>
<a id="__codelineno-80-33" name="__codelineno-80-33"></a>
<a id="__codelineno-80-34" name="__codelineno-80-34"></a><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">80</span><span class="p">);</span>
</code></pre></div>
<p>! Be aware of literal evaluation with use of ` character to surround mongodb connection URL instead of ' character like before.</p>
<p>To test, type below command in a terminal and refresh Internet browser's page at 'localhost' address:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="go">docker-compose up</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a><span class="go">..</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a><span class="go">server_1  | [02.01.2022 20:32.25.069] [LOG]   {</span>
<a id="__codelineno-81-4" name="__codelineno-81-4"></a><span class="go">server_1  |   NODE_VERSION: &#39;17.3.0&#39;,</span>
<a id="__codelineno-81-5" name="__codelineno-81-5"></a><span class="go">server_1  |   HOSTNAME: &#39;e9e18205ee72&#39;,</span>
<a id="__codelineno-81-6" name="__codelineno-81-6"></a><span class="go">server_1  |   YARN_VERSION: &#39;1.22.17&#39;,</span>
<a id="__codelineno-81-7" name="__codelineno-81-7"></a><span class="go">server_1  |   SHLVL: &#39;1&#39;,</span>
<a id="__codelineno-81-8" name="__codelineno-81-8"></a><span class="go">server_1  |   HOME: &#39;/root&#39;,</span>
<a id="__codelineno-81-9" name="__codelineno-81-9"></a><span class="go">server_1  |   PATH: &#39;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/app/node_modules/.bin&#39;,</span>
<a id="__codelineno-81-10" name="__codelineno-81-10"></a><span class="go">server_1  |   MONGO_USER_PASSWORD: &#39;456&#39;,</span>
<a id="__codelineno-81-11" name="__codelineno-81-11"></a><span class="go">server_1  |   PWD: &#39;/app&#39;,</span>
<a id="__codelineno-81-12" name="__codelineno-81-12"></a><span class="go">server_1  |   MONGO_USER_NAME: &#39;tintin&#39;</span>
<a id="__codelineno-81-13" name="__codelineno-81-13"></a><span class="go">server_1  | }</span>
<a id="__codelineno-81-14" name="__codelineno-81-14"></a><span class="go">..</span>
</code></pre></div>
<hr />
<h2 id="depends-and-restart">Depends and Restart</h2>
<h3 id="depends">Depends</h3>
<p>Specify containers up priority order (depends_on).<br />
E.g. in our application we want that server (Node.js application) start only once database (MongoDB) container is up.</p>
<p>docker-compose.yml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a>
<a id="__codelineno-82-3" name="__codelineno-82-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-82-4" name="__codelineno-82-4"></a>
<a id="__codelineno-82-5" name="__codelineno-82-5"></a>  <span class="nt">db</span><span class="p">:</span>
<a id="__codelineno-82-6" name="__codelineno-82-6"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-82-7" name="__codelineno-82-7"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_USERNAME</span>
<a id="__codelineno-82-8" name="__codelineno-82-8"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_PASSWORD</span>
<a id="__codelineno-82-9" name="__codelineno-82-9"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
<a id="__codelineno-82-10" name="__codelineno-82-10"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-82-11" name="__codelineno-82-11"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-82-12" name="__codelineno-82-12"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mydb</span>
<a id="__codelineno-82-13" name="__codelineno-82-13"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
<a id="__codelineno-82-14" name="__codelineno-82-14"></a>
<a id="__codelineno-82-15" name="__codelineno-82-15"></a>  <span class="nt">server</span><span class="p">:</span>
<a id="__codelineno-82-16" name="__codelineno-82-16"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-82-17" name="__codelineno-82-17"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_NAME</span>
<a id="__codelineno-82-18" name="__codelineno-82-18"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_PASSWORD</span>
<a id="__codelineno-82-19" name="__codelineno-82-19"></a>    <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-82-20" name="__codelineno-82-20"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-82-21" name="__codelineno-82-21"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-82-22" name="__codelineno-82-22"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-82-23" name="__codelineno-82-23"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-82-24" name="__codelineno-82-24"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src</span>
<a id="__codelineno-82-25" name="__codelineno-82-25"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/src</span>
<a id="__codelineno-82-26" name="__codelineno-82-26"></a>    <span class="nt">depends_on</span><span class="p">:</span>
<a id="__codelineno-82-27" name="__codelineno-82-27"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-82-28" name="__codelineno-82-28"></a>
<a id="__codelineno-82-29" name="__codelineno-82-29"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-82-30" name="__codelineno-82-30"></a>  <span class="nt">mydb</span><span class="p">:</span>
<a id="__codelineno-82-31" name="__codelineno-82-31"></a>    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>In a terminal, type below command and you may observe, in logs, that, first, we have database logs, then server logs:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="go">docker-compose up</span>
<a id="__codelineno-83-2" name="__codelineno-83-2"></a>
<a id="__codelineno-83-3" name="__codelineno-83-3"></a><span class="go">Attaching to db_1, server_1</span>
<a id="__codelineno-83-4" name="__codelineno-83-4"></a><span class="go">db_1      | ..</span>
<a id="__codelineno-83-5" name="__codelineno-83-5"></a><span class="go">db_1      | ..</span>
<a id="__codelineno-83-6" name="__codelineno-83-6"></a><span class="go">..</span>
<a id="__codelineno-83-7" name="__codelineno-83-7"></a>
<a id="__codelineno-83-8" name="__codelineno-83-8"></a><span class="go">server_1  | ..</span>
<a id="__codelineno-83-9" name="__codelineno-83-9"></a><span class="go">server_1  | ..</span>
<a id="__codelineno-83-10" name="__codelineno-83-10"></a><span class="go">..</span>
</code></pre></div>
<h3 id="restart">Restart</h3>
<p>restart:  </p>
<ul>
<li><strong>"no"</strong> (between quotes because without it has a yaml signification), default value, never restart automatically.  </li>
<li><strong>always</strong> restart if container stop from inside or Docker daemon restart, but not with a 'docker-compose stop' command.  </li>
<li><strong>on-failure</strong> restart container only on quit with error code.  </li>
<li><strong>unless-stopped</strong> always restart unless stopped manually with a 'docker-compose stop' command.  </li>
</ul>
<p>To test it we add a '/err' route to the server to exit the process (process.exit(errorCode)).<br />
app.js:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;console-stamp&#39;</span> <span class="p">)(</span> <span class="nx">console</span> <span class="p">);</span>  <span class="c1">// to add timestamp in logs</span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a>
<a id="__codelineno-84-3" name="__codelineno-84-3"></a><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">);</span>
<a id="__codelineno-84-4" name="__codelineno-84-4"></a>
<a id="__codelineno-84-5" name="__codelineno-84-5"></a><span class="kd">const</span> <span class="nx">MongoClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongodb&#39;</span><span class="p">).</span><span class="nx">MongoClient</span><span class="p">;</span>
<a id="__codelineno-84-6" name="__codelineno-84-6"></a>
<a id="__codelineno-84-7" name="__codelineno-84-7"></a><span class="kd">let</span> <span class="nx">count</span><span class="p">;</span>
<a id="__codelineno-84-8" name="__codelineno-84-8"></a>
<a id="__codelineno-84-9" name="__codelineno-84-9"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">)</span> <span class="c1">// to have environnement variables in logs</span>
<a id="__codelineno-84-10" name="__codelineno-84-10"></a>
<a id="__codelineno-84-11" name="__codelineno-84-11"></a><span class="nx">MongoClient</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="sb">`mongodb://</span><span class="si">${</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGO_USER_NAME</span> <span class="si">}</span><span class="sb">:</span><span class="si">${</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGO_USER_PASSWORD</span> <span class="si">}</span><span class="sb">@db`</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">client</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-84-12" name="__codelineno-84-12"></a>  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-84-13" name="__codelineno-84-13"></a>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<a id="__codelineno-84-14" name="__codelineno-84-14"></a>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-84-15" name="__codelineno-84-15"></a>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;CONNECTION DB OK!&#39;</span><span class="p">);</span>
<a id="__codelineno-84-16" name="__codelineno-84-16"></a>    <span class="nx">count</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">db</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">).</span><span class="nx">collection</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">);</span>
<a id="__codelineno-84-17" name="__codelineno-84-17"></a>  <span class="p">}</span>
<a id="__codelineno-84-18" name="__codelineno-84-18"></a><span class="p">});</span>
<a id="__codelineno-84-19" name="__codelineno-84-19"></a>
<a id="__codelineno-84-20" name="__codelineno-84-20"></a><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<a id="__codelineno-84-21" name="__codelineno-84-21"></a>
<a id="__codelineno-84-22" name="__codelineno-84-22"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/err&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-84-23" name="__codelineno-84-23"></a>  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<a id="__codelineno-84-24" name="__codelineno-84-24"></a><span class="p">});</span>
<a id="__codelineno-84-25" name="__codelineno-84-25"></a>
<a id="__codelineno-84-26" name="__codelineno-84-26"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-84-27" name="__codelineno-84-27"></a>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;request url: &#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<a id="__codelineno-84-28" name="__codelineno-84-28"></a>  <span class="nx">count</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">({},</span> <span class="p">{</span> <span class="nx">$inc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">count</span><span class="o">:</span> <span class="mf">1</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">returnNewDocument</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">doc</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-84-29" name="__codelineno-84-29"></a>    <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<a id="__codelineno-84-30" name="__codelineno-84-30"></a>    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
<a id="__codelineno-84-31" name="__codelineno-84-31"></a>  <span class="p">})</span>
<a id="__codelineno-84-32" name="__codelineno-84-32"></a><span class="p">});</span>
<a id="__codelineno-84-33" name="__codelineno-84-33"></a>
<a id="__codelineno-84-34" name="__codelineno-84-34"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-84-35" name="__codelineno-84-35"></a>  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<a id="__codelineno-84-36" name="__codelineno-84-36"></a><span class="p">});</span>
<a id="__codelineno-84-37" name="__codelineno-84-37"></a>
<a id="__codelineno-84-38" name="__codelineno-84-38"></a><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">80</span><span class="p">);</span>
</code></pre></div>
<p>For testing purpose (different restart modes) avoid using nodemon.<br />
Dockerfile:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a>FROM node:alpine
<a id="__codelineno-85-2" name="__codelineno-85-2"></a>WORKDIR /app
<a id="__codelineno-85-3" name="__codelineno-85-3"></a>COPY ./package.json .
<a id="__codelineno-85-4" name="__codelineno-85-4"></a>RUN npm install
<a id="__codelineno-85-5" name="__codelineno-85-5"></a>COPY . .
<a id="__codelineno-85-6" name="__codelineno-85-6"></a>ENV PATH=$PATH:/app/node_modules/.bin
<a id="__codelineno-85-7" name="__codelineno-85-7"></a>CMD [&quot;node&quot;, &quot;src/app.js&quot;]
</code></pre></div>
<p>Terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="go">docker-compose down</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="go">docker-compose build --no-cache</span>
</code></pre></div>
<h4 id="no">no</h4>
<p>docker-compose.yml (restart: "no"):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a>
<a id="__codelineno-87-3" name="__codelineno-87-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-87-4" name="__codelineno-87-4"></a>
<a id="__codelineno-87-5" name="__codelineno-87-5"></a>  <span class="nt">db</span><span class="p">:</span>
<a id="__codelineno-87-6" name="__codelineno-87-6"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-87-7" name="__codelineno-87-7"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_USERNAME</span>
<a id="__codelineno-87-8" name="__codelineno-87-8"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_PASSWORD</span>
<a id="__codelineno-87-9" name="__codelineno-87-9"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
<a id="__codelineno-87-10" name="__codelineno-87-10"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-87-11" name="__codelineno-87-11"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-87-12" name="__codelineno-87-12"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mydb</span>
<a id="__codelineno-87-13" name="__codelineno-87-13"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
<a id="__codelineno-87-14" name="__codelineno-87-14"></a>
<a id="__codelineno-87-15" name="__codelineno-87-15"></a>  <span class="nt">server</span><span class="p">:</span>
<a id="__codelineno-87-16" name="__codelineno-87-16"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-87-17" name="__codelineno-87-17"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_NAME</span>
<a id="__codelineno-87-18" name="__codelineno-87-18"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_PASSWORD</span>
<a id="__codelineno-87-19" name="__codelineno-87-19"></a>    <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-87-20" name="__codelineno-87-20"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-87-21" name="__codelineno-87-21"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-87-22" name="__codelineno-87-22"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-87-23" name="__codelineno-87-23"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-87-24" name="__codelineno-87-24"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src</span>
<a id="__codelineno-87-25" name="__codelineno-87-25"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/src</span>
<a id="__codelineno-87-26" name="__codelineno-87-26"></a>    <span class="nt">depends_on</span><span class="p">:</span>
<a id="__codelineno-87-27" name="__codelineno-87-27"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-87-28" name="__codelineno-87-28"></a>    <span class="nt">restart</span><span class="p">:</span> <span class="s">&quot;no&quot;</span>
<a id="__codelineno-87-29" name="__codelineno-87-29"></a>
<a id="__codelineno-87-30" name="__codelineno-87-30"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-87-31" name="__codelineno-87-31"></a>  <span class="nt">mydb</span><span class="p">:</span>
<a id="__codelineno-87-32" name="__codelineno-87-32"></a>    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>Test:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="go">docker-compose down</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a><span class="go">docker-compose up</span>
</code></pre></div>
<p>Navigate in Internet browser to:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a>http://localhost/err
</code></pre></div>
<p>You may observe in logs:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="go">..</span>
<a id="__codelineno-90-2" name="__codelineno-90-2"></a><span class="go">server_1 exited with code 0</span>
<a id="__codelineno-90-3" name="__codelineno-90-3"></a><span class="go">..</span>
</code></pre></div>
<p>In another terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="go">docker ps -a</span>
<a id="__codelineno-91-2" name="__codelineno-91-2"></a><span class="go">CONTAINER ID   IMAGE                COMMAND                  CREATED              STATUS</span>
<a id="__codelineno-91-3" name="__codelineno-91-3"></a><span class="go">63c2040a78c6   node-server_server   &quot;docker-entrypoint.s&quot;   About a minute ago   Exited (0) About a minute ago     </span>
<a id="__codelineno-91-4" name="__codelineno-91-4"></a><span class="go">2d8b795bf1ed   mongo                &quot;docker-entrypoint.s&quot;   7 minutes ago        Up About a minute</span>
</code></pre></div>
<p>And server isn't available anymore.</p>
<h4 id="always">always</h4>
<p>docker-compose.yml (restart: always):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a>
<a id="__codelineno-92-3" name="__codelineno-92-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-92-4" name="__codelineno-92-4"></a>
<a id="__codelineno-92-5" name="__codelineno-92-5"></a>  <span class="nt">db</span><span class="p">:</span>
<a id="__codelineno-92-6" name="__codelineno-92-6"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-92-7" name="__codelineno-92-7"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_USERNAME</span>
<a id="__codelineno-92-8" name="__codelineno-92-8"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_PASSWORD</span>
<a id="__codelineno-92-9" name="__codelineno-92-9"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
<a id="__codelineno-92-10" name="__codelineno-92-10"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-92-11" name="__codelineno-92-11"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-92-12" name="__codelineno-92-12"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mydb</span>
<a id="__codelineno-92-13" name="__codelineno-92-13"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
<a id="__codelineno-92-14" name="__codelineno-92-14"></a>
<a id="__codelineno-92-15" name="__codelineno-92-15"></a>  <span class="nt">server</span><span class="p">:</span>
<a id="__codelineno-92-16" name="__codelineno-92-16"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-92-17" name="__codelineno-92-17"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_NAME</span>
<a id="__codelineno-92-18" name="__codelineno-92-18"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_PASSWORD</span>
<a id="__codelineno-92-19" name="__codelineno-92-19"></a>    <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-92-20" name="__codelineno-92-20"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-92-21" name="__codelineno-92-21"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-92-22" name="__codelineno-92-22"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-92-23" name="__codelineno-92-23"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-92-24" name="__codelineno-92-24"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src</span>
<a id="__codelineno-92-25" name="__codelineno-92-25"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/src</span>
<a id="__codelineno-92-26" name="__codelineno-92-26"></a>    <span class="nt">depends_on</span><span class="p">:</span>
<a id="__codelineno-92-27" name="__codelineno-92-27"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-92-28" name="__codelineno-92-28"></a>    <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">always</span>
<a id="__codelineno-92-29" name="__codelineno-92-29"></a>
<a id="__codelineno-92-30" name="__codelineno-92-30"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-92-31" name="__codelineno-92-31"></a>  <span class="nt">mydb</span><span class="p">:</span>
<a id="__codelineno-92-32" name="__codelineno-92-32"></a>    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>Terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="go">docker-compose up</span>
</code></pre></div>
<p>In an Internet browser, navigate alternatively to following addresses and observe in logs server exit and restart automatically:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a>http://localhost/
<a id="__codelineno-94-2" name="__codelineno-94-2"></a>http://localhost/err
</code></pre></div>
<p>Terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="go">..</span>
<a id="__codelineno-95-2" name="__codelineno-95-2"></a><span class="go">server_1  | [03.01.2022 16:24.28.780] [LOG]   CONNECTION DB OK!</span>
<a id="__codelineno-95-3" name="__codelineno-95-3"></a><span class="go">..</span>
<a id="__codelineno-95-4" name="__codelineno-95-4"></a><span class="go">server_1 exited with code 0</span>
<a id="__codelineno-95-5" name="__codelineno-95-5"></a><span class="go">..</span>
<a id="__codelineno-95-6" name="__codelineno-95-6"></a><span class="go">server_1  | [03.01.2022 16:27.10.339] [LOG]   CONNECTION DB OK!</span>
<a id="__codelineno-95-7" name="__codelineno-95-7"></a><span class="go">..</span>
</code></pre></div>
<p>In another terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-96-2" name="__codelineno-96-2"></a><span class="go">NAME                   COMMAND                  SERVICE             STATUS              PORTS</span>
<a id="__codelineno-96-3" name="__codelineno-96-3"></a><span class="go">node-server_db_1       &quot;docker-entrypoint.s&quot;   db                  running             27017/tcp</span>
<a id="__codelineno-96-4" name="__codelineno-96-4"></a><span class="go">node-server_server_1   &quot;docker-entrypoint.s&quot;   server              running             0.0.0.0:80-&gt;80/tcp</span>
</code></pre></div>
<p>If we "manually" stop 'server' container from another terminal with below command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="go">docker-compose stop server</span>
</code></pre></div>
<p>And then restart the Docker daemon, we may observe the 'server' that has restart automatically due to his 'always' restart policy and 'db' is down because, for now, he hasn't any restart policy defined in docker-compose yaml configuration file.</p>
<h4 id="on-failure">on-failure</h4>
<p>docker-compose.yml (restart: on-failure):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-98-2" name="__codelineno-98-2"></a>
<a id="__codelineno-98-3" name="__codelineno-98-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-98-4" name="__codelineno-98-4"></a>
<a id="__codelineno-98-5" name="__codelineno-98-5"></a>  <span class="nt">db</span><span class="p">:</span>
<a id="__codelineno-98-6" name="__codelineno-98-6"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-98-7" name="__codelineno-98-7"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_USERNAME</span>
<a id="__codelineno-98-8" name="__codelineno-98-8"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_PASSWORD</span>
<a id="__codelineno-98-9" name="__codelineno-98-9"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
<a id="__codelineno-98-10" name="__codelineno-98-10"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-98-11" name="__codelineno-98-11"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-98-12" name="__codelineno-98-12"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mydb</span>
<a id="__codelineno-98-13" name="__codelineno-98-13"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
<a id="__codelineno-98-14" name="__codelineno-98-14"></a>
<a id="__codelineno-98-15" name="__codelineno-98-15"></a>  <span class="nt">server</span><span class="p">:</span>
<a id="__codelineno-98-16" name="__codelineno-98-16"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-98-17" name="__codelineno-98-17"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_NAME</span>
<a id="__codelineno-98-18" name="__codelineno-98-18"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_PASSWORD</span>
<a id="__codelineno-98-19" name="__codelineno-98-19"></a>    <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-98-20" name="__codelineno-98-20"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-98-21" name="__codelineno-98-21"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-98-22" name="__codelineno-98-22"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-98-23" name="__codelineno-98-23"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-98-24" name="__codelineno-98-24"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src</span>
<a id="__codelineno-98-25" name="__codelineno-98-25"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/src</span>
<a id="__codelineno-98-26" name="__codelineno-98-26"></a>    <span class="nt">depends_on</span><span class="p">:</span>
<a id="__codelineno-98-27" name="__codelineno-98-27"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-98-28" name="__codelineno-98-28"></a>    <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">on-failure</span>
<a id="__codelineno-98-29" name="__codelineno-98-29"></a>
<a id="__codelineno-98-30" name="__codelineno-98-30"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-98-31" name="__codelineno-98-31"></a>  <span class="nt">mydb</span><span class="p">:</span>
<a id="__codelineno-98-32" name="__codelineno-98-32"></a>    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>Terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="go">docker-compose down</span>
<a id="__codelineno-99-2" name="__codelineno-99-2"></a><span class="go">docker-compose up -d</span>
<a id="__codelineno-99-3" name="__codelineno-99-3"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-99-4" name="__codelineno-99-4"></a><span class="go">NAME                   COMMAND                  SERVICE             STATUS              PORTS</span>
<a id="__codelineno-99-5" name="__codelineno-99-5"></a><span class="go">node-server_db_1       &quot;docker-entrypoint.s&quot;   db                  running             27017/tcp</span>
<a id="__codelineno-99-6" name="__codelineno-99-6"></a><span class="go">node-server_server_1   &quot;docker-entrypoint.s&quot;   server              running             0.0.0.0:80-&gt;80/tcp</span>
</code></pre></div>
<p>Browse to:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1"></a>http://localhost/err
</code></pre></div>
<p>In app.js exit code is '0' = no error, therefore container does not restart automatically:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a><span class="go">NAME                   COMMAND                  SERVICE             STATUS              PORTS</span>
<a id="__codelineno-101-3" name="__codelineno-101-3"></a><span class="go">node-server_db_1       &quot;docker-entrypoint.s&quot;   db                  running             27017/tcp</span>
<a id="__codelineno-101-4" name="__codelineno-101-4"></a><span class="go">node-server_server_1   &quot;docker-entrypoint.s&quot;   server              exited (0)</span>
</code></pre></div>
<p>Modify exit code of 'err' route to app.js with '1', app.js:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;console-stamp&#39;</span> <span class="p">)(</span> <span class="nx">console</span> <span class="p">);</span>  <span class="c1">// to add timestamp in logs</span>
<a id="__codelineno-102-2" name="__codelineno-102-2"></a>
<a id="__codelineno-102-3" name="__codelineno-102-3"></a><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;express&quot;</span><span class="p">);</span>
<a id="__codelineno-102-4" name="__codelineno-102-4"></a>
<a id="__codelineno-102-5" name="__codelineno-102-5"></a><span class="kd">const</span> <span class="nx">MongoClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;mongodb&#39;</span><span class="p">).</span><span class="nx">MongoClient</span><span class="p">;</span>
<a id="__codelineno-102-6" name="__codelineno-102-6"></a>
<a id="__codelineno-102-7" name="__codelineno-102-7"></a><span class="kd">let</span> <span class="nx">count</span><span class="p">;</span>
<a id="__codelineno-102-8" name="__codelineno-102-8"></a>
<a id="__codelineno-102-9" name="__codelineno-102-9"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">)</span> <span class="c1">// to have environnement variables in logs</span>
<a id="__codelineno-102-10" name="__codelineno-102-10"></a>
<a id="__codelineno-102-11" name="__codelineno-102-11"></a><span class="nx">MongoClient</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="sb">`mongodb://</span><span class="si">${</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGO_USER_NAME</span> <span class="si">}</span><span class="sb">:</span><span class="si">${</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MONGO_USER_PASSWORD</span> <span class="si">}</span><span class="sb">@db`</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useUnifiedTopology</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">client</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-102-12" name="__codelineno-102-12"></a>  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-102-13" name="__codelineno-102-13"></a>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<a id="__codelineno-102-14" name="__codelineno-102-14"></a>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-102-15" name="__codelineno-102-15"></a>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;CONNECTION DB OK!&#39;</span><span class="p">);</span>
<a id="__codelineno-102-16" name="__codelineno-102-16"></a>    <span class="nx">count</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">db</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">).</span><span class="nx">collection</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">);</span>
<a id="__codelineno-102-17" name="__codelineno-102-17"></a>  <span class="p">}</span>
<a id="__codelineno-102-18" name="__codelineno-102-18"></a><span class="p">});</span>
<a id="__codelineno-102-19" name="__codelineno-102-19"></a>
<a id="__codelineno-102-20" name="__codelineno-102-20"></a><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<a id="__codelineno-102-21" name="__codelineno-102-21"></a>
<a id="__codelineno-102-22" name="__codelineno-102-22"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/err&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-102-23" name="__codelineno-102-23"></a>  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-102-24" name="__codelineno-102-24"></a><span class="p">});</span>
<a id="__codelineno-102-25" name="__codelineno-102-25"></a>
<a id="__codelineno-102-26" name="__codelineno-102-26"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-102-27" name="__codelineno-102-27"></a>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;request url: &#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<a id="__codelineno-102-28" name="__codelineno-102-28"></a>  <span class="nx">count</span><span class="p">.</span><span class="nx">findOneAndUpdate</span><span class="p">({},</span> <span class="p">{</span> <span class="nx">$inc</span><span class="o">:</span> <span class="p">{</span> <span class="nx">count</span><span class="o">:</span> <span class="mf">1</span> <span class="p">}</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">returnNewDocument</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">doc</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-102-29" name="__codelineno-102-29"></a>    <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<a id="__codelineno-102-30" name="__codelineno-102-30"></a>    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">).</span><span class="nx">json</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
<a id="__codelineno-102-31" name="__codelineno-102-31"></a>  <span class="p">})</span>
<a id="__codelineno-102-32" name="__codelineno-102-32"></a><span class="p">});</span>
<a id="__codelineno-102-33" name="__codelineno-102-33"></a>
<a id="__codelineno-102-34" name="__codelineno-102-34"></a><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<a id="__codelineno-102-35" name="__codelineno-102-35"></a>  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<a id="__codelineno-102-36" name="__codelineno-102-36"></a><span class="p">});</span>
<a id="__codelineno-102-37" name="__codelineno-102-37"></a>
<a id="__codelineno-102-38" name="__codelineno-102-38"></a><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">80</span><span class="p">);</span>
</code></pre></div>
<p>Terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="go">docker-compose down</span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a><span class="go">docker-compose up -d</span>
<a id="__codelineno-103-3" name="__codelineno-103-3"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-103-4" name="__codelineno-103-4"></a><span class="go">NAME                   COMMAND                  SERVICE             STATUS              PORTS</span>
<a id="__codelineno-103-5" name="__codelineno-103-5"></a><span class="go">node-server_db_1       &quot;docker-entrypoint.s&quot;   db                  running             27017/tcp</span>
<a id="__codelineno-103-6" name="__codelineno-103-6"></a><span class="go">node-server_server_1   &quot;docker-entrypoint.s&quot;   server              running             0.0.0.0:80-&gt;80/tcp</span>
</code></pre></div>
<p>Browse to:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a>http://localhost/err
</code></pre></div>
<p>In app.js exit code is '1' = error, therefore container restart automatically:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-105-2" name="__codelineno-105-2"></a><span class="go">NAME                   COMMAND                  SERVICE             STATUS              PORTS</span>
<a id="__codelineno-105-3" name="__codelineno-105-3"></a><span class="go">node-server_db_1       &quot;docker-entrypoint.s&quot;   db                  running             27017/tcp</span>
<a id="__codelineno-105-4" name="__codelineno-105-4"></a><span class="go">node-server_server_1   &quot;docker-entrypoint.s&quot;   server              running             0.0.0.0:80-&gt;80/tcp</span>
</code></pre></div>
<h4 id="unless-stopped">unless-stopped</h4>
<p>Will always restart except if stopped "manually" with 'docker-compose stop server', then restart Docker daemon, then stopped 'server' container will not restart.</p>
<p>docker-compose.yml (restart: unless-stopped):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.8&#39;</span>
<a id="__codelineno-106-2" name="__codelineno-106-2"></a>
<a id="__codelineno-106-3" name="__codelineno-106-3"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-106-4" name="__codelineno-106-4"></a>
<a id="__codelineno-106-5" name="__codelineno-106-5"></a>  <span class="nt">db</span><span class="p">:</span>
<a id="__codelineno-106-6" name="__codelineno-106-6"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-106-7" name="__codelineno-106-7"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_USERNAME</span>
<a id="__codelineno-106-8" name="__codelineno-106-8"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_INITDB_ROOT_PASSWORD</span>
<a id="__codelineno-106-9" name="__codelineno-106-9"></a>    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongo</span>
<a id="__codelineno-106-10" name="__codelineno-106-10"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-106-11" name="__codelineno-106-11"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">volume</span>
<a id="__codelineno-106-12" name="__codelineno-106-12"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mydb</span>
<a id="__codelineno-106-13" name="__codelineno-106-13"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/db</span>
<a id="__codelineno-106-14" name="__codelineno-106-14"></a>
<a id="__codelineno-106-15" name="__codelineno-106-15"></a>  <span class="nt">server</span><span class="p">:</span>
<a id="__codelineno-106-16" name="__codelineno-106-16"></a>    <span class="nt">environment</span><span class="p">:</span>
<a id="__codelineno-106-17" name="__codelineno-106-17"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_NAME</span>
<a id="__codelineno-106-18" name="__codelineno-106-18"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">MONGO_USER_PASSWORD</span>
<a id="__codelineno-106-19" name="__codelineno-106-19"></a>    <span class="nt">build</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
<a id="__codelineno-106-20" name="__codelineno-106-20"></a>    <span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-106-21" name="__codelineno-106-21"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">80:80</span>
<a id="__codelineno-106-22" name="__codelineno-106-22"></a>    <span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-106-23" name="__codelineno-106-23"></a>      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bind</span>
<a id="__codelineno-106-24" name="__codelineno-106-24"></a>        <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src</span>
<a id="__codelineno-106-25" name="__codelineno-106-25"></a>        <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/src</span>
<a id="__codelineno-106-26" name="__codelineno-106-26"></a>    <span class="nt">depends_on</span><span class="p">:</span>
<a id="__codelineno-106-27" name="__codelineno-106-27"></a>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">db</span>
<a id="__codelineno-106-28" name="__codelineno-106-28"></a>    <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<a id="__codelineno-106-29" name="__codelineno-106-29"></a>
<a id="__codelineno-106-30" name="__codelineno-106-30"></a><span class="nt">volumes</span><span class="p">:</span>
<a id="__codelineno-106-31" name="__codelineno-106-31"></a>  <span class="nt">mydb</span><span class="p">:</span>
<a id="__codelineno-106-32" name="__codelineno-106-32"></a>    <span class="nt">external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>Terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="go">docker-compose down</span>
<a id="__codelineno-107-2" name="__codelineno-107-2"></a><span class="go">docker-compose up -d</span>
<a id="__codelineno-107-3" name="__codelineno-107-3"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-107-4" name="__codelineno-107-4"></a><span class="go">NAME                   COMMAND                  SERVICE             STATUS              PORTS</span>
<a id="__codelineno-107-5" name="__codelineno-107-5"></a><span class="go">node-server_db_1       &quot;docker-entrypoint.s&quot;   db                  running             27017/tcp</span>
<a id="__codelineno-107-6" name="__codelineno-107-6"></a><span class="go">node-server_server_1   &quot;docker-entrypoint.s&quot;   server              running             0.0.0.0:80-&gt;80/tcp</span>
<a id="__codelineno-107-7" name="__codelineno-107-7"></a><span class="go">docker-compose stop server</span>
<a id="__codelineno-107-8" name="__codelineno-107-8"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-107-9" name="__codelineno-107-9"></a><span class="go">NAME                   COMMAND                  SERVICE             STATUS              PORTS</span>
<a id="__codelineno-107-10" name="__codelineno-107-10"></a><span class="go">node-server_db_1       &quot;docker-entrypoint.s&quot;   db                  running             27017/tcp</span>
<a id="__codelineno-107-11" name="__codelineno-107-11"></a><span class="go">node-server_server_1   &quot;docker-entrypoint.s&quot;   server              exited (137)</span>
</code></pre></div>
<p>Restart Docker daemon, then:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-108-2" name="__codelineno-108-2"></a><span class="go">NAME                   COMMAND                  SERVICE             STATUS              PORTS</span>
<a id="__codelineno-108-3" name="__codelineno-108-3"></a><span class="go">node-server_db_1       &quot;docker-entrypoint.s&quot;   db                  exited (255)        27017/tcp</span>
<a id="__codelineno-108-4" name="__codelineno-108-4"></a><span class="go">node-server_server_1   &quot;docker-entrypoint.s&quot;   server              exited (137)</span>
</code></pre></div>
<p>We may observe that 'server' container hasn't restarted automatically due to fact it has been "manually" stopped before Docker daemon restart.</p>
<p>Note that you can change the restart configuration of an already running container by doing:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1"></a><span class="go">docker container update --restart unless-stopped ID</span>
</code></pre></div>
<hr />
<h2 id="other-commands">Other commands</h2>
<p>First:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1"></a><span class="go">docker-compose up -d</span>
</code></pre></div>
<h3 id="logs">logs</h3>
<p>View output from containers:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="go">docker-compose logs</span>
<a id="__codelineno-111-2" name="__codelineno-111-2"></a><span class="go">..</span>
<a id="__codelineno-111-3" name="__codelineno-111-3"></a><span class="go">db_1  | ..</span>
<a id="__codelineno-111-4" name="__codelineno-111-4"></a><span class="go">server_1  | ..</span>
<a id="__codelineno-111-5" name="__codelineno-111-5"></a><span class="go">..</span>
</code></pre></div>
<p>To follow -f option, to show timestamps -t options:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1"></a><span class="go">docker-compose logs -f -t</span>
</code></pre></div>
<p>'Ctrl+c' does not stop containers, stop only logs display:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1"></a><span class="go">Ctrl+c</span>
<a id="__codelineno-113-2" name="__codelineno-113-2"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-113-3" name="__codelineno-113-3"></a><span class="go">NAME                   COMMAND                  SERVICE             STATUS              PORTS</span>
<a id="__codelineno-113-4" name="__codelineno-113-4"></a><span class="go">node-server_db_1       &quot;docker-entrypoint.s&quot;   db                  running             27017/tcp</span>
<a id="__codelineno-113-5" name="__codelineno-113-5"></a><span class="go">node-server_server_1   &quot;docker-entrypoint.s&quot;   server              running             0.0.0.0:80-&gt;80/tcp</span>
</code></pre></div>
<h3 id="top">top</h3>
<p>Display the running processes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1"></a><span class="go">docker-compose top</span>
</code></pre></div>
<h3 id="misc">misc</h3>
<p>Stop a container:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1"></a><span class="go">docker-compose stop server</span>
<a id="__codelineno-115-2" name="__codelineno-115-2"></a>
<a id="__codelineno-115-3" name="__codelineno-115-3"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-115-4" name="__codelineno-115-4"></a><span class="go">NAME                   COMMAND                  SERVICE             STATUS              PORTS</span>
<a id="__codelineno-115-5" name="__codelineno-115-5"></a><span class="go">node-server_db_1       &quot;docker-entrypoint.s&quot;   db                  running             27017/tcp</span>
<a id="__codelineno-115-6" name="__codelineno-115-6"></a><span class="go">node-server_server_1   &quot;docker-entrypoint.s&quot;   server              exited (137)</span>
</code></pre></div>
<p>Remove a stopped container:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1"></a><span class="go">docker-compose rm server</span>
<a id="__codelineno-116-2" name="__codelineno-116-2"></a>
<a id="__codelineno-116-3" name="__codelineno-116-3"></a><span class="go">docker-compose ps</span>
<a id="__codelineno-116-4" name="__codelineno-116-4"></a><span class="go">NAME                COMMAND                  SERVICE             STATUS              PORTS</span>
<a id="__codelineno-116-5" name="__codelineno-116-5"></a><span class="go">node-server_db_1    &quot;docker-entrypoint.s&quot;   db                  running             27017/tcp</span>
</code></pre></div>
<p>Remove a running container (+ -f to avoid confirm's need):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1"></a><span class="go">docker-compose rm -s server</span>
</code></pre></div>
<p>Remove anonym volumes belonging to container:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1"></a><span class="go">docker-compose rm -v db</span>
</code></pre></div>
<p>After removing a container, to get it back (+ -d):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1"></a><span class="go">docker-compose up</span>
</code></pre></div>
<p>Port mapping information and entering ip allowed (0.0.0.0 for all entering ip address allowed):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1"></a><span class="go">docker-compose port server 80</span>
<a id="__codelineno-120-2" name="__codelineno-120-2"></a><span class="go">0.0.0.0:80</span>
</code></pre></div>
<p>Means, outside port 80 is mapped to inside port 80 and all ip addresses allowed.</p>
<h3 id="config">config</h3>
<p>Let see environnement variables replaced with found values and configuration that will then be used to build the stack:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1"></a><span class="go">docker-compose config</span>
<a id="__codelineno-121-2" name="__codelineno-121-2"></a>
<a id="__codelineno-121-3" name="__codelineno-121-3"></a><span class="go">services:</span>
<a id="__codelineno-121-4" name="__codelineno-121-4"></a><span class="go">  db:</span>
<a id="__codelineno-121-5" name="__codelineno-121-5"></a><span class="go">    environment:</span>
<a id="__codelineno-121-6" name="__codelineno-121-6"></a><span class="go">      MONGO_INITDB_ROOT_PASSWORD: &quot;123&quot;</span>
<a id="__codelineno-121-7" name="__codelineno-121-7"></a><span class="go">      MONGO_INITDB_ROOT_USERNAME: toto</span>
<a id="__codelineno-121-8" name="__codelineno-121-8"></a><span class="go">    image: mongo</span>
<a id="__codelineno-121-9" name="__codelineno-121-9"></a><span class="go">    restart: unless-stopped</span>
<a id="__codelineno-121-10" name="__codelineno-121-10"></a><span class="go">    volumes:</span>
<a id="__codelineno-121-11" name="__codelineno-121-11"></a><span class="go">    - type: volume</span>
<a id="__codelineno-121-12" name="__codelineno-121-12"></a><span class="go">      source: mydb</span>
<a id="__codelineno-121-13" name="__codelineno-121-13"></a><span class="go">      target: /data/db</span>
<a id="__codelineno-121-14" name="__codelineno-121-14"></a><span class="go">  server:</span>
<a id="__codelineno-121-15" name="__codelineno-121-15"></a><span class="go">    build:</span>
<a id="__codelineno-121-16" name="__codelineno-121-16"></a><span class="go">      context: .</span>
<a id="__codelineno-121-17" name="__codelineno-121-17"></a><span class="go">    depends_on:</span>
<a id="__codelineno-121-18" name="__codelineno-121-18"></a><span class="go">      db:</span>
<a id="__codelineno-121-19" name="__codelineno-121-19"></a><span class="go">        condition: service_started</span>
<a id="__codelineno-121-20" name="__codelineno-121-20"></a><span class="go">    environment:</span>
<a id="__codelineno-121-21" name="__codelineno-121-21"></a><span class="go">      MONGO_USER_NAME: tintin</span>
<a id="__codelineno-121-22" name="__codelineno-121-22"></a><span class="go">      MONGO_USER_PASSWORD: &quot;456&quot;</span>
<a id="__codelineno-121-23" name="__codelineno-121-23"></a><span class="go">    ports:</span>
<a id="__codelineno-121-24" name="__codelineno-121-24"></a><span class="go">    - mode: ingress</span>
<a id="__codelineno-121-25" name="__codelineno-121-25"></a><span class="go">      target: 80</span>
<a id="__codelineno-121-26" name="__codelineno-121-26"></a><span class="go">      published: 80</span>
<a id="__codelineno-121-27" name="__codelineno-121-27"></a><span class="go">      protocol: tcp</span>
<a id="__codelineno-121-28" name="__codelineno-121-28"></a><span class="go">    restart: unless-stopped</span>
<a id="__codelineno-121-29" name="__codelineno-121-29"></a><span class="go">    volumes:</span>
<a id="__codelineno-121-30" name="__codelineno-121-30"></a><span class="go">    - type: bind</span>
<a id="__codelineno-121-31" name="__codelineno-121-31"></a><span class="go">      source: /mnt/c/git/doc/test/docker/node-server/src</span>
<a id="__codelineno-121-32" name="__codelineno-121-32"></a><span class="go">      target: /app/src</span>
<a id="__codelineno-121-33" name="__codelineno-121-33"></a><span class="go">volumes:</span>
<a id="__codelineno-121-34" name="__codelineno-121-34"></a><span class="go">  mydb:</span>
<a id="__codelineno-121-35" name="__codelineno-121-35"></a><span class="go">    name: mydb</span>
<a id="__codelineno-121-36" name="__codelineno-121-36"></a><span class="go">    external: true</span>
</code></pre></div>
<h3 id="pull-push">pull push</h3>
<p>pull: get latest images of containers that compose the stack.
push: if image has been modified with custom Dockerfile, let us push it to Docker Hub.</p>
<hr />

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../7-docker-network/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Docker - 07 - Network" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Docker - 07 - Network
            </div>
          </div>
        </a>
      
      
        
        <a href="../9-compose-dockerfile/" class="md-footer__link md-footer__link--next" aria-label="Next: Compose - 09 - Dockerfile" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Compose - 09 - Dockerfile
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.01824240.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.e0abf5b0.min.js"></script>
      
    
  </body>
</html>